<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Tutorial - Candle Documentation</title>
<meta name="generator" content="Hugo 0.112.3">
<link href="https://candle.dev/docs//index.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="https://candle.dev/docs/getting-started/tutorial/">
<link rel="stylesheet" href="https://candle.dev/docs/css/theme.min.css">
<link rel="stylesheet" href="https://candle.dev/docs/css/chroma.min.css">
<script defer src="https://candle.dev/docs//js/fontawesome6/all.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js" integrity="sha256-H3cjtrm/ztDeuhCN9I4yh4iN2Ybx/y1RM7rMmAesA0k=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js" integrity="sha256-4XodgW4TwIJuDtf+v6vDJ39FVxI0veC/kSCCmnFp7ck=" crossorigin="anonymous"></script>
<script src="https://candle.dev/docs/js/bundle.js"></script><style>
:root {}
</style>
<meta property="og:title" content="Tutorial" />
<meta property="og:description" content="Start a new project In this tutorial we&rsquo;ll be making a template renderer component in Rust.
The wick repository includes templates in the templates/ folder with templates in the common liquid template format. Use cargo generate (cargo install cargo-generate) to easily pull, render, and setup new components.
$ cargo generate candlecorp/wick templates/rust --name jinja The template comes with a sample component.yaml that defines two operations, greet and add.
--- name: &#39;jinja&#39; format: 1 metadata: version: &#39;0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://candle.dev/docs/getting-started/tutorial/" /><meta property="article:section" content="getting-started" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Tutorial"/>
<meta name="twitter:description" content="Start a new project In this tutorial we&rsquo;ll be making a template renderer component in Rust.
The wick repository includes templates in the templates/ folder with templates in the common liquid template format. Use cargo generate (cargo install cargo-generate) to easily pull, render, and setup new components.
$ cargo generate candlecorp/wick templates/rust --name jinja The template comes with a sample component.yaml that defines two operations, greet and add.
--- name: &#39;jinja&#39; format: 1 metadata: version: &#39;0."/>
<meta itemprop="name" content="Tutorial">
<meta itemprop="description" content="Start a new project In this tutorial we&rsquo;ll be making a template renderer component in Rust.
The wick repository includes templates in the templates/ folder with templates in the common liquid template format. Use cargo generate (cargo install cargo-generate) to easily pull, render, and setup new components.
$ cargo generate candlecorp/wick templates/rust --name jinja The template comes with a sample component.yaml that defines two operations, greet and add.
--- name: &#39;jinja&#39; format: 1 metadata: version: &#39;0.">

<meta itemprop="wordCount" content="782">
<meta itemprop="keywords" content="" /></head>
<body><div class="container"><header>
<h1>Candle Documentation</h1>
</header>


<div class="content-container">
<main><h1>Tutorial</h1>
<h1 id="start-a-new-project">Start a new project</h1>
<p>In this tutorial we&rsquo;ll be making a template renderer component in Rust.</p>
<p>The <code>wick</code> repository includes templates in the <code>templates/</code> folder with templates in the common <code>liquid</code> template format. Use <code>cargo generate</code> (<code>cargo install cargo-generate</code>) to easily pull, render, and setup new components.</p>
<pre tabindex="0"><code>$ cargo generate candlecorp/wick templates/rust --name jinja
</code></pre><p>The template comes with a sample <code>component.yaml</code> that defines two operations, <code>greet</code> and <code>add</code>.</p>
<pre tabindex="0"><code>---
name: &#39;jinja&#39;
format: 1
metadata:
  version: &#39;0.0.1&#39;
operations:
  - name: greet
    inputs:
      - name: input
        type: string
    outputs:
      - name: output
        type: string
  - name: add
    inputs:
      - name: left
        type: u64
      - name: right
        type: u64
    outputs:
      - name: output
        type: u64
</code></pre><p>This file powers Wick&rsquo;s code generation and is embedded into your WebAssembly module at build time. Wick uses the configuration and its operations, types, descriptions, and other metadata to automatically configure and validate Wick applications.</p>
<p>Get rid of the example operations and add one called <code>render</code>. The <code>render</code> operation will take template source and arbitrary data to use as the context. The template will be a <code>string</code> type and – since template data can be anything – the data input can be a generic <code>struct</code>. The <code>struct</code> type represents any JSON-like object. Name our output stream  <code>output</code> and give it a type of <code>string</code>.</p>
<p>The <code>component.yaml</code> should now look like this:</p>
<pre tabindex="0"><code>---
name: &#39;jinja&#39;
format: 1
metadata:
  version: &#39;0.0.2&#39;
operations:
  - name: render
    inputs:
      - name: template
        type: string
      - name: data
        type: struct
    outputs:
      - name: output
        type: string
</code></pre><h1 id="add-dependencies">Add dependencies</h1>
<p>Add the template renderer <code>minijinja</code> to our project with <code>cargo add</code> or by modifying the <code>Cargo.toml</code> file by hand. <code>minijinja</code> is a rust implementation of the <a href="https://jinja.palletsprojects.com/en/3.1.x/">jinja</a> template library.</p>
<pre tabindex="0"><code>$ cargo add minijinja
</code></pre><h1 id="update-implementation">Update implementation</h1>
<p>This template&rsquo;s build step will generate a <code>Component</code> struct and traits for every operation defined in the manifest. The operation traits take each input as a separate stream argument and one final argument for the output stream(s).</p>
<p><em>Note: The generated code can be found in your <code>target</code> directory. Have a peek at the generated code by looking in the <code>target/wasm32-unknown-unknown/debug/build/jinja-*/out/</code> directory (after running a build at least once). The code generator runs every time the <code>component.yaml</code> file changes.</em></p>
<p>Replace the contents of <code>src/lib.rs</code> with the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rs" data-lang="rs"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> wasmrs_guest::<span style="color:#f92672">*</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">mod</span> wick {
</span></span><span style="display:flex;"><span>    wick_component::wick_import!();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> wick::<span style="color:#f92672">*</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#[async_trait::async_trait(?Send)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span> OpRender <span style="color:#66d9ef">for</span> Component {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">render</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">mut</span> input: <span style="color:#a6e22e">WickStream</span><span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">mut</span> data: <span style="color:#a6e22e">WickStream</span><span style="color:#f92672">&lt;</span>Value<span style="color:#f92672">&gt;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">mut</span> outputs: <span style="color:#a6e22e">OpRenderOutputs</span>,
</span></span><span style="display:flex;"><span>    ) -&gt; <span style="color:#a6e22e">wick</span>::Result<span style="color:#f92672">&lt;</span>()<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">let</span> (Some(Ok(input)), Some(Ok(data))) <span style="color:#f92672">=</span> (input.next().<span style="color:#66d9ef">await</span>, data.next().<span style="color:#66d9ef">await</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> env <span style="color:#f92672">=</span> minijinja::Environment::new();
</span></span><span style="display:flex;"><span>            env.add_template(<span style="color:#e6db74">&#34;root&#34;</span>, <span style="color:#f92672">&amp;</span>input).unwrap();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> template <span style="color:#f92672">=</span> env.get_template(<span style="color:#e6db74">&#34;root&#34;</span>).unwrap();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> rendered <span style="color:#f92672">=</span> template.render(data).unwrap();
</span></span><span style="display:flex;"><span>            outputs.output.send(<span style="color:#f92672">&amp;</span>rendered);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        outputs.output.done();
</span></span><span style="display:flex;"><span>        Ok(())
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The body of the implementation is standard rust code that can use any crate you&rsquo;ve added to your <code>Cargo.toml</code>. Wick uses streams everywhere so – even though we&rsquo;re just taking a single input – we&rsquo;re waiting for pairs of values to come in from both streams. This let&rsquo;s our components be used in  be reused easily in many different cases and let&rsquo;s us build more complex components that can adapt to more.</p>
<p>Inside the loop we follow the <a href="https://crates.io/crates/minijinja">guide for <code>minijinja</code></a> to compile a template and render it with our data.</p>
<p>Finally we send the rendered output to our <code>output</code> stream with <code>outputs.output.send()</code>.</p>
<p>Outside the loop we can do whatever cleanup we need and close the output streams with <code>outputs.output.done()</code>.</p>
<h1 id="run-just-build">Run just build</h1>
<p>Run the <code>just build</code> task to compile our code to WebAssembly, embed our component definition and types, and sign the module with our private key. If you don&rsquo;t have any keys yet, <code>wick</code> will make them for you automatically and put them in <code>~/.wick/keys/</code>.</p>
<pre tabindex="0"><code>$ just build
</code></pre><h1 id="run-your-component">Run your component</h1>
<p>Use <code>wick invoke</code> to invoke any operation in your signed component <code>.wasm</code> file. By default, the built artifacts get copied to a <code>build</code> directory in the project root.</p>
<p><code>wick invoke</code> takes the path to your <code>.wasm</code> file, the name of the operation to invoke, and any arguments to pass to the operation. The <code>--</code> is required to separate the arguments to <code>wick invoke</code> from the arguments to the operation.</p>
<p><em>Note: The data passed to each argument is treated as JSON. The <code>data</code> argument should contain valid JSON that will be processed before sending to your component. The <code>template</code> argument is a string and <code>wick</code> will automatically wrap unquoted, invalid JSON with a string before processing it.</em></p>
<pre tabindex="0"><code>$ wick invoke ./build/jinja.signed.wasm render -- --template &#39;Hello {{ name }}!&#39; --data &#39;{&#34;name&#34;: &#34;Samuel Clemens&#34;}&#39;
{&#34;payload&#34;:{&#34;value&#34;:&#34;Hello Samuel Clemens!&#34;},&#34;port&#34;:&#34;output&#34;}
</code></pre><p>Success! <code>wick</code> loaded our component, validated it&rsquo;s integrity, found our operation, and invoked it with the arguments we passed. The output is a JSON-ified representation of Wick packets, the pieces of data that flow through pipelines in the wick runtime.</p>
<div class="edit-meta">

<br></div><nav class="pagination"><a class="nav nav-prev" href="https://candle.dev/docs/getting-started/installation/" title="Installation"><i class="fas fa-arrow-left" aria-hidden="true"></i>&nbsp;Prev - Installation</a>
<a class="nav nav-next" href="https://candle.dev/docs/getting-started/installation/" title="Installation">Next - Installation <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav><footer><p class="powered">Powered by <a href="https://gohugo.io">Hugo</a>. Theme by <a href="https://themes.gohugo.io/hugo-theme-techdoc/">TechDoc</a>. Designed by <a href="https://github.com/thingsym/hugo-theme-techdoc">Thingsym</a>.</p>
</footer>
</main>
<div class="sidebar">

<nav class="open-menu">
<ul>
<li class=""><a href="https://candle.dev/docs/">Home</a></li>

<li class=""><a href="https://candle.dev/docs/overview/">Overview</a>
  
<ul class="sub-menu">
<li class=""><a href="https://candle.dev/docs/overview/concepts/">Core Concepts</a></li>
<li class=""><a href="https://candle.dev/docs/overview/streaming/">Streaming</a></li>
</ul>
  
</li>

<li class="parent"><a href="https://candle.dev/docs/getting-started/">Getting Started</a>
  
<ul class="sub-menu">
<li class=""><a href="https://candle.dev/docs/getting-started/installation/">Installation</a></li>
<li class="active"><a href="https://candle.dev/docs/getting-started/tutorial/">Tutorial</a></li>
</ul>
  
</li>
</ul>
</nav>



<div class="sidebar-footer"></div>
</div>

</div><a href="#" id="backtothetop-fixed" class="backtothetop"
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>
</div>
</body>
</html>
