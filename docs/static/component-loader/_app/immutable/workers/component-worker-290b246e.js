var Ti=Object.defineProperty;var Si=(C,Fe,B)=>Fe in C?Ti(C,Fe,{enumerable:!0,configurable:!0,writable:!0,value:B}):C[Fe]=B;var j=(C,Fe,B)=>(Si(C,typeof Fe!="symbol"?Fe+"":Fe,B),B);(function(){"use strict";var C=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fe(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var B={},ur={},vt={};vt.byteLength=Jr,vt.toByteArray=en,vt.fromByteArray=nn;for(var ye=[],ae=[],Yr=typeof Uint8Array<"u"?Uint8Array:Array,Bt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Qe=0,Kr=Bt.length;Qe<Kr;++Qe)ye[Qe]=Bt[Qe],ae[Bt.charCodeAt(Qe)]=Qe;ae["-".charCodeAt(0)]=62,ae["_".charCodeAt(0)]=63;function lr(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var s=t===e?0:4-t%4;return[t,s]}function Jr(r){var e=lr(r),t=e[0],s=e[1];return(t+s)*3/4-s}function Zr(r,e,t){return(e+t)*3/4-t}function en(r){var e,t=lr(r),s=t[0],d=t[1],a=new Yr(Zr(r,s,d)),c=0,u=d>0?s-4:s,f;for(f=0;f<u;f+=4)e=ae[r.charCodeAt(f)]<<18|ae[r.charCodeAt(f+1)]<<12|ae[r.charCodeAt(f+2)]<<6|ae[r.charCodeAt(f+3)],a[c++]=e>>16&255,a[c++]=e>>8&255,a[c++]=e&255;return d===2&&(e=ae[r.charCodeAt(f)]<<2|ae[r.charCodeAt(f+1)]>>4,a[c++]=e&255),d===1&&(e=ae[r.charCodeAt(f)]<<10|ae[r.charCodeAt(f+1)]<<4|ae[r.charCodeAt(f+2)]>>2,a[c++]=e>>8&255,a[c++]=e&255),a}function tn(r){return ye[r>>18&63]+ye[r>>12&63]+ye[r>>6&63]+ye[r&63]}function rn(r,e,t){for(var s,d=[],a=e;a<t;a+=3)s=(r[a]<<16&16711680)+(r[a+1]<<8&65280)+(r[a+2]&255),d.push(tn(s));return d.join("")}function nn(r){for(var e,t=r.length,s=t%3,d=[],a=16383,c=0,u=t-s;c<u;c+=a)d.push(rn(r,c,c+a>u?u:c+a));return s===1?(e=r[t-1],d.push(ye[e>>2]+ye[e<<4&63]+"==")):s===2&&(e=(r[t-2]<<8)+r[t-1],d.push(ye[e>>10]+ye[e>>4&63]+ye[e<<2&63]+"=")),d.join("")}var Pt={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Pt.read=function(r,e,t,s,d){var a,c,u=d*8-s-1,f=(1<<u)-1,g=f>>1,_=-7,m=t?d-1:0,E=t?-1:1,y=r[e+m];for(m+=E,a=y&(1<<-_)-1,y>>=-_,_+=u;_>0;a=a*256+r[e+m],m+=E,_-=8);for(c=a&(1<<-_)-1,a>>=-_,_+=s;_>0;c=c*256+r[e+m],m+=E,_-=8);if(a===0)a=1-g;else{if(a===f)return c?NaN:(y?-1:1)*(1/0);c=c+Math.pow(2,s),a=a-g}return(y?-1:1)*c*Math.pow(2,a-s)},Pt.write=function(r,e,t,s,d,a){var c,u,f,g=a*8-d-1,_=(1<<g)-1,m=_>>1,E=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,y=s?0:a-1,T=s?1:-1,S=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(u=isNaN(e)?1:0,c=_):(c=Math.floor(Math.log(e)/Math.LN2),e*(f=Math.pow(2,-c))<1&&(c--,f*=2),c+m>=1?e+=E/f:e+=E*Math.pow(2,1-m),e*f>=2&&(c++,f/=2),c+m>=_?(u=0,c=_):c+m>=1?(u=(e*f-1)*Math.pow(2,d),c=c+m):(u=e*Math.pow(2,m-1)*Math.pow(2,d),c=0));d>=8;r[t+y]=u&255,y+=T,u/=256,d-=8);for(c=c<<d|u,g+=d;g>0;r[t+y]=c&255,y+=T,c/=256,g-=8);r[t+y-T]|=S*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(r){const e=vt,t=Pt,s=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=u,r.SlowBuffer=U,r.INSPECT_MAX_BYTES=50;const d=2147483647;r.kMaxLength=d,u.TYPED_ARRAY_SUPPORT=a(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function a(){try{const l=new Uint8Array(1),n={foo:function(){return 42}};return Object.setPrototypeOf(n,Uint8Array.prototype),Object.setPrototypeOf(l,n),l.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function c(l){if(l>d)throw new RangeError('The value "'+l+'" is invalid for option "size"');const n=new Uint8Array(l);return Object.setPrototypeOf(n,u.prototype),n}function u(l,n,i){if(typeof l=="number"){if(typeof n=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(l)}return f(l,n,i)}u.poolSize=8192;function f(l,n,i){if(typeof l=="string")return E(l,n);if(ArrayBuffer.isView(l))return T(l);if(l==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof l);if(le(l,ArrayBuffer)||l&&le(l.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(le(l,SharedArrayBuffer)||l&&le(l.buffer,SharedArrayBuffer)))return S(l,n,i);if(typeof l=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const h=l.valueOf&&l.valueOf();if(h!=null&&h!==l)return u.from(h,n,i);const R=F(l);if(R)return R;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof l[Symbol.toPrimitive]=="function")return u.from(l[Symbol.toPrimitive]("string"),n,i);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof l)}u.from=function(l,n,i){return f(l,n,i)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array);function g(l){if(typeof l!="number")throw new TypeError('"size" argument must be of type number');if(l<0)throw new RangeError('The value "'+l+'" is invalid for option "size"')}function _(l,n,i){return g(l),l<=0?c(l):n!==void 0?typeof i=="string"?c(l).fill(n,i):c(l).fill(n):c(l)}u.alloc=function(l,n,i){return _(l,n,i)};function m(l){return g(l),c(l<0?0:b(l)|0)}u.allocUnsafe=function(l){return m(l)},u.allocUnsafeSlow=function(l){return m(l)};function E(l,n){if((typeof n!="string"||n==="")&&(n="utf8"),!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n);const i=q(l,n)|0;let h=c(i);const R=h.write(l,n);return R!==i&&(h=h.slice(0,R)),h}function y(l){const n=l.length<0?0:b(l.length)|0,i=c(n);for(let h=0;h<n;h+=1)i[h]=l[h]&255;return i}function T(l){if(le(l,Uint8Array)){const n=new Uint8Array(l);return S(n.buffer,n.byteOffset,n.byteLength)}return y(l)}function S(l,n,i){if(n<0||l.byteLength<n)throw new RangeError('"offset" is outside of buffer bounds');if(l.byteLength<n+(i||0))throw new RangeError('"length" is outside of buffer bounds');let h;return n===void 0&&i===void 0?h=new Uint8Array(l):i===void 0?h=new Uint8Array(l,n):h=new Uint8Array(l,n,i),Object.setPrototypeOf(h,u.prototype),h}function F(l){if(u.isBuffer(l)){const n=b(l.length)|0,i=c(n);return i.length===0||l.copy(i,0,0,n),i}if(l.length!==void 0)return typeof l.length!="number"||it(l.length)?c(0):y(l);if(l.type==="Buffer"&&Array.isArray(l.data))return y(l.data)}function b(l){if(l>=d)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+d.toString(16)+" bytes");return l|0}function U(l){return+l!=l&&(l=0),u.alloc(+l)}u.isBuffer=function(n){return n!=null&&n._isBuffer===!0&&n!==u.prototype},u.compare=function(n,i){if(le(n,Uint8Array)&&(n=u.from(n,n.offset,n.byteLength)),le(i,Uint8Array)&&(i=u.from(i,i.offset,i.byteLength)),!u.isBuffer(n)||!u.isBuffer(i))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(n===i)return 0;let h=n.length,R=i.length;for(let o=0,p=Math.min(h,R);o<p;++o)if(n[o]!==i[o]){h=n[o],R=i[o];break}return h<R?-1:R<h?1:0},u.isEncoding=function(n){switch(String(n).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(n,i){if(!Array.isArray(n))throw new TypeError('"list" argument must be an Array of Buffers');if(n.length===0)return u.alloc(0);let h;if(i===void 0)for(i=0,h=0;h<n.length;++h)i+=n[h].length;const R=u.allocUnsafe(i);let o=0;for(h=0;h<n.length;++h){let p=n[h];if(le(p,Uint8Array))o+p.length>R.length?(u.isBuffer(p)||(p=u.from(p)),p.copy(R,o)):Uint8Array.prototype.set.call(R,p,o);else if(u.isBuffer(p))p.copy(R,o);else throw new TypeError('"list" argument must be an Array of Buffers');o+=p.length}return R};function q(l,n){if(u.isBuffer(l))return l.length;if(ArrayBuffer.isView(l)||le(l,ArrayBuffer))return l.byteLength;if(typeof l!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof l);const i=l.length,h=arguments.length>2&&arguments[2]===!0;if(!h&&i===0)return 0;let R=!1;for(;;)switch(n){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return _t(l).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return i*2;case"hex":return i>>>1;case"base64":return Mt(l).length;default:if(R)return h?-1:_t(l).length;n=(""+n).toLowerCase(),R=!0}}u.byteLength=q;function O(l,n,i){let h=!1;if((n===void 0||n<0)&&(n=0),n>this.length||((i===void 0||i>this.length)&&(i=this.length),i<=0)||(i>>>=0,n>>>=0,i<=n))return"";for(l||(l="utf8");;)switch(l){case"hex":return qe(this,n,i);case"utf8":case"utf-8":return J(this,n,i);case"ascii":return Pe(this,n,i);case"latin1":case"binary":return ke(this,n,i);case"base64":return se(this,n,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return rt(this,n,i);default:if(h)throw new TypeError("Unknown encoding: "+l);l=(l+"").toLowerCase(),h=!0}}u.prototype._isBuffer=!0;function z(l,n,i){const h=l[n];l[n]=l[i],l[i]=h}u.prototype.swap16=function(){const n=this.length;if(n%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let i=0;i<n;i+=2)z(this,i,i+1);return this},u.prototype.swap32=function(){const n=this.length;if(n%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let i=0;i<n;i+=4)z(this,i,i+3),z(this,i+1,i+2);return this},u.prototype.swap64=function(){const n=this.length;if(n%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let i=0;i<n;i+=8)z(this,i,i+7),z(this,i+1,i+6),z(this,i+2,i+5),z(this,i+3,i+4);return this},u.prototype.toString=function(){const n=this.length;return n===0?"":arguments.length===0?J(this,0,n):O.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(n){if(!u.isBuffer(n))throw new TypeError("Argument must be a Buffer");return this===n?!0:u.compare(this,n)===0},u.prototype.inspect=function(){let n="";const i=r.INSPECT_MAX_BYTES;return n=this.toString("hex",0,i).replace(/(.{2})/g,"$1 ").trim(),this.length>i&&(n+=" ... "),"<Buffer "+n+">"},s&&(u.prototype[s]=u.prototype.inspect),u.prototype.compare=function(n,i,h,R,o){if(le(n,Uint8Array)&&(n=u.from(n,n.offset,n.byteLength)),!u.isBuffer(n))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof n);if(i===void 0&&(i=0),h===void 0&&(h=n?n.length:0),R===void 0&&(R=0),o===void 0&&(o=this.length),i<0||h>n.length||R<0||o>this.length)throw new RangeError("out of range index");if(R>=o&&i>=h)return 0;if(R>=o)return-1;if(i>=h)return 1;if(i>>>=0,h>>>=0,R>>>=0,o>>>=0,this===n)return 0;let p=o-R,v=h-i;const w=Math.min(p,v),N=this.slice(R,o),A=n.slice(i,h);for(let x=0;x<w;++x)if(N[x]!==A[x]){p=N[x],v=A[x];break}return p<v?-1:v<p?1:0};function H(l,n,i,h,R){if(l.length===0)return-1;if(typeof i=="string"?(h=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,it(i)&&(i=R?0:l.length-1),i<0&&(i=l.length+i),i>=l.length){if(R)return-1;i=l.length-1}else if(i<0)if(R)i=0;else return-1;if(typeof n=="string"&&(n=u.from(n,h)),u.isBuffer(n))return n.length===0?-1:te(l,n,i,h,R);if(typeof n=="number")return n=n&255,typeof Uint8Array.prototype.indexOf=="function"?R?Uint8Array.prototype.indexOf.call(l,n,i):Uint8Array.prototype.lastIndexOf.call(l,n,i):te(l,[n],i,h,R);throw new TypeError("val must be string, number or Buffer")}function te(l,n,i,h,R){let o=1,p=l.length,v=n.length;if(h!==void 0&&(h=String(h).toLowerCase(),h==="ucs2"||h==="ucs-2"||h==="utf16le"||h==="utf-16le")){if(l.length<2||n.length<2)return-1;o=2,p/=2,v/=2,i/=2}function w(A,x){return o===1?A[x]:A.readUInt16BE(x*o)}let N;if(R){let A=-1;for(N=i;N<p;N++)if(w(l,N)===w(n,A===-1?0:N-A)){if(A===-1&&(A=N),N-A+1===v)return A*o}else A!==-1&&(N-=N-A),A=-1}else for(i+v>p&&(i=p-v),N=i;N>=0;N--){let A=!0;for(let x=0;x<v;x++)if(w(l,N+x)!==w(n,x)){A=!1;break}if(A)return N}return-1}u.prototype.includes=function(n,i,h){return this.indexOf(n,i,h)!==-1},u.prototype.indexOf=function(n,i,h){return H(this,n,i,h,!0)},u.prototype.lastIndexOf=function(n,i,h){return H(this,n,i,h,!1)};function re(l,n,i,h){i=Number(i)||0;const R=l.length-i;h?(h=Number(h),h>R&&(h=R)):h=R;const o=n.length;h>o/2&&(h=o/2);let p;for(p=0;p<h;++p){const v=parseInt(n.substr(p*2,2),16);if(it(v))return p;l[i+p]=v}return p}function ne(l,n,i,h){return nt(_t(n,l.length-i),l,i,h)}function he(l,n,i,h){return nt(sr(n),l,i,h)}function ie(l,n,i,h){return nt(Mt(n),l,i,h)}function $(l,n,i,h){return nt(Lt(n,l.length-i),l,i,h)}u.prototype.write=function(n,i,h,R){if(i===void 0)R="utf8",h=this.length,i=0;else if(h===void 0&&typeof i=="string")R=i,h=this.length,i=0;else if(isFinite(i))i=i>>>0,isFinite(h)?(h=h>>>0,R===void 0&&(R="utf8")):(R=h,h=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const o=this.length-i;if((h===void 0||h>o)&&(h=o),n.length>0&&(h<0||i<0)||i>this.length)throw new RangeError("Attempt to write outside buffer bounds");R||(R="utf8");let p=!1;for(;;)switch(R){case"hex":return re(this,n,i,h);case"utf8":case"utf-8":return ne(this,n,i,h);case"ascii":case"latin1":case"binary":return he(this,n,i,h);case"base64":return ie(this,n,i,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $(this,n,i,h);default:if(p)throw new TypeError("Unknown encoding: "+R);R=(""+R).toLowerCase(),p=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function se(l,n,i){return n===0&&i===l.length?e.fromByteArray(l):e.fromByteArray(l.slice(n,i))}function J(l,n,i){i=Math.min(l.length,i);const h=[];let R=n;for(;R<i;){const o=l[R];let p=null,v=o>239?4:o>223?3:o>191?2:1;if(R+v<=i){let w,N,A,x;switch(v){case 1:o<128&&(p=o);break;case 2:w=l[R+1],(w&192)===128&&(x=(o&31)<<6|w&63,x>127&&(p=x));break;case 3:w=l[R+1],N=l[R+2],(w&192)===128&&(N&192)===128&&(x=(o&15)<<12|(w&63)<<6|N&63,x>2047&&(x<55296||x>57343)&&(p=x));break;case 4:w=l[R+1],N=l[R+2],A=l[R+3],(w&192)===128&&(N&192)===128&&(A&192)===128&&(x=(o&15)<<18|(w&63)<<12|(N&63)<<6|A&63,x>65535&&x<1114112&&(p=x))}}p===null?(p=65533,v=1):p>65535&&(p-=65536,h.push(p>>>10&1023|55296),p=56320|p&1023),h.push(p),R+=v}return Ue(h)}const Ie=4096;function Ue(l){const n=l.length;if(n<=Ie)return String.fromCharCode.apply(String,l);let i="",h=0;for(;h<n;)i+=String.fromCharCode.apply(String,l.slice(h,h+=Ie));return i}function Pe(l,n,i){let h="";i=Math.min(l.length,i);for(let R=n;R<i;++R)h+=String.fromCharCode(l[R]&127);return h}function ke(l,n,i){let h="";i=Math.min(l.length,i);for(let R=n;R<i;++R)h+=String.fromCharCode(l[R]);return h}function qe(l,n,i){const h=l.length;(!n||n<0)&&(n=0),(!i||i<0||i>h)&&(i=h);let R="";for(let o=n;o<i;++o)R+=ar[l[o]];return R}function rt(l,n,i){const h=l.slice(n,i);let R="";for(let o=0;o<h.length-1;o+=2)R+=String.fromCharCode(h[o]+h[o+1]*256);return R}u.prototype.slice=function(n,i){const h=this.length;n=~~n,i=i===void 0?h:~~i,n<0?(n+=h,n<0&&(n=0)):n>h&&(n=h),i<0?(i+=h,i<0&&(i=0)):i>h&&(i=h),i<n&&(i=n);const R=this.subarray(n,i);return Object.setPrototypeOf(R,u.prototype),R};function Q(l,n,i){if(l%1!==0||l<0)throw new RangeError("offset is not uint");if(l+n>i)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(n,i,h){n=n>>>0,i=i>>>0,h||Q(n,i,this.length);let R=this[n],o=1,p=0;for(;++p<i&&(o*=256);)R+=this[n+p]*o;return R},u.prototype.readUintBE=u.prototype.readUIntBE=function(n,i,h){n=n>>>0,i=i>>>0,h||Q(n,i,this.length);let R=this[n+--i],o=1;for(;i>0&&(o*=256);)R+=this[n+--i]*o;return R},u.prototype.readUint8=u.prototype.readUInt8=function(n,i){return n=n>>>0,i||Q(n,1,this.length),this[n]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(n,i){return n=n>>>0,i||Q(n,2,this.length),this[n]|this[n+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(n,i){return n=n>>>0,i||Q(n,2,this.length),this[n]<<8|this[n+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(n,i){return n=n>>>0,i||Q(n,4,this.length),(this[n]|this[n+1]<<8|this[n+2]<<16)+this[n+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(n,i){return n=n>>>0,i||Q(n,4,this.length),this[n]*16777216+(this[n+1]<<16|this[n+2]<<8|this[n+3])},u.prototype.readBigUInt64LE=we(function(n){n=n>>>0,Me(n,"offset");const i=this[n],h=this[n+7];(i===void 0||h===void 0)&&He(n,this.length-8);const R=i+this[++n]*2**8+this[++n]*2**16+this[++n]*2**24,o=this[++n]+this[++n]*2**8+this[++n]*2**16+h*2**24;return BigInt(R)+(BigInt(o)<<BigInt(32))}),u.prototype.readBigUInt64BE=we(function(n){n=n>>>0,Me(n,"offset");const i=this[n],h=this[n+7];(i===void 0||h===void 0)&&He(n,this.length-8);const R=i*2**24+this[++n]*2**16+this[++n]*2**8+this[++n],o=this[++n]*2**24+this[++n]*2**16+this[++n]*2**8+h;return(BigInt(R)<<BigInt(32))+BigInt(o)}),u.prototype.readIntLE=function(n,i,h){n=n>>>0,i=i>>>0,h||Q(n,i,this.length);let R=this[n],o=1,p=0;for(;++p<i&&(o*=256);)R+=this[n+p]*o;return o*=128,R>=o&&(R-=Math.pow(2,8*i)),R},u.prototype.readIntBE=function(n,i,h){n=n>>>0,i=i>>>0,h||Q(n,i,this.length);let R=i,o=1,p=this[n+--R];for(;R>0&&(o*=256);)p+=this[n+--R]*o;return o*=128,p>=o&&(p-=Math.pow(2,8*i)),p},u.prototype.readInt8=function(n,i){return n=n>>>0,i||Q(n,1,this.length),this[n]&128?(255-this[n]+1)*-1:this[n]},u.prototype.readInt16LE=function(n,i){n=n>>>0,i||Q(n,2,this.length);const h=this[n]|this[n+1]<<8;return h&32768?h|4294901760:h},u.prototype.readInt16BE=function(n,i){n=n>>>0,i||Q(n,2,this.length);const h=this[n+1]|this[n]<<8;return h&32768?h|4294901760:h},u.prototype.readInt32LE=function(n,i){return n=n>>>0,i||Q(n,4,this.length),this[n]|this[n+1]<<8|this[n+2]<<16|this[n+3]<<24},u.prototype.readInt32BE=function(n,i){return n=n>>>0,i||Q(n,4,this.length),this[n]<<24|this[n+1]<<16|this[n+2]<<8|this[n+3]},u.prototype.readBigInt64LE=we(function(n){n=n>>>0,Me(n,"offset");const i=this[n],h=this[n+7];(i===void 0||h===void 0)&&He(n,this.length-8);const R=this[n+4]+this[n+5]*2**8+this[n+6]*2**16+(h<<24);return(BigInt(R)<<BigInt(32))+BigInt(i+this[++n]*2**8+this[++n]*2**16+this[++n]*2**24)}),u.prototype.readBigInt64BE=we(function(n){n=n>>>0,Me(n,"offset");const i=this[n],h=this[n+7];(i===void 0||h===void 0)&&He(n,this.length-8);const R=(i<<24)+this[++n]*2**16+this[++n]*2**8+this[++n];return(BigInt(R)<<BigInt(32))+BigInt(this[++n]*2**24+this[++n]*2**16+this[++n]*2**8+h)}),u.prototype.readFloatLE=function(n,i){return n=n>>>0,i||Q(n,4,this.length),t.read(this,n,!0,23,4)},u.prototype.readFloatBE=function(n,i){return n=n>>>0,i||Q(n,4,this.length),t.read(this,n,!1,23,4)},u.prototype.readDoubleLE=function(n,i){return n=n>>>0,i||Q(n,8,this.length),t.read(this,n,!0,52,8)},u.prototype.readDoubleBE=function(n,i){return n=n>>>0,i||Q(n,8,this.length),t.read(this,n,!1,52,8)};function G(l,n,i,h,R,o){if(!u.isBuffer(l))throw new TypeError('"buffer" argument must be a Buffer instance');if(n>R||n<o)throw new RangeError('"value" argument is out of bounds');if(i+h>l.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(n,i,h,R){if(n=+n,i=i>>>0,h=h>>>0,!R){const v=Math.pow(2,8*h)-1;G(this,n,i,h,v,0)}let o=1,p=0;for(this[i]=n&255;++p<h&&(o*=256);)this[i+p]=n/o&255;return i+h},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(n,i,h,R){if(n=+n,i=i>>>0,h=h>>>0,!R){const v=Math.pow(2,8*h)-1;G(this,n,i,h,v,0)}let o=h-1,p=1;for(this[i+o]=n&255;--o>=0&&(p*=256);)this[i+o]=n/p&255;return i+h},u.prototype.writeUint8=u.prototype.writeUInt8=function(n,i,h){return n=+n,i=i>>>0,h||G(this,n,i,1,255,0),this[i]=n&255,i+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(n,i,h){return n=+n,i=i>>>0,h||G(this,n,i,2,65535,0),this[i]=n&255,this[i+1]=n>>>8,i+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(n,i,h){return n=+n,i=i>>>0,h||G(this,n,i,2,65535,0),this[i]=n>>>8,this[i+1]=n&255,i+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(n,i,h){return n=+n,i=i>>>0,h||G(this,n,i,4,4294967295,0),this[i+3]=n>>>24,this[i+2]=n>>>16,this[i+1]=n>>>8,this[i]=n&255,i+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(n,i,h){return n=+n,i=i>>>0,h||G(this,n,i,4,4294967295,0),this[i]=n>>>24,this[i+1]=n>>>16,this[i+2]=n>>>8,this[i+3]=n&255,i+4};function pe(l,n,i,h,R){Dt(n,h,R,l,i,7);let o=Number(n&BigInt(4294967295));l[i++]=o,o=o>>8,l[i++]=o,o=o>>8,l[i++]=o,o=o>>8,l[i++]=o;let p=Number(n>>BigInt(32)&BigInt(4294967295));return l[i++]=p,p=p>>8,l[i++]=p,p=p>>8,l[i++]=p,p=p>>8,l[i++]=p,i}function ze(l,n,i,h,R){Dt(n,h,R,l,i,7);let o=Number(n&BigInt(4294967295));l[i+7]=o,o=o>>8,l[i+6]=o,o=o>>8,l[i+5]=o,o=o>>8,l[i+4]=o;let p=Number(n>>BigInt(32)&BigInt(4294967295));return l[i+3]=p,p=p>>8,l[i+2]=p,p=p>>8,l[i+1]=p,p=p>>8,l[i]=p,i+8}u.prototype.writeBigUInt64LE=we(function(n,i=0){return pe(this,n,i,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=we(function(n,i=0){return ze(this,n,i,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(n,i,h,R){if(n=+n,i=i>>>0,!R){const w=Math.pow(2,8*h-1);G(this,n,i,h,w-1,-w)}let o=0,p=1,v=0;for(this[i]=n&255;++o<h&&(p*=256);)n<0&&v===0&&this[i+o-1]!==0&&(v=1),this[i+o]=(n/p>>0)-v&255;return i+h},u.prototype.writeIntBE=function(n,i,h,R){if(n=+n,i=i>>>0,!R){const w=Math.pow(2,8*h-1);G(this,n,i,h,w-1,-w)}let o=h-1,p=1,v=0;for(this[i+o]=n&255;--o>=0&&(p*=256);)n<0&&v===0&&this[i+o+1]!==0&&(v=1),this[i+o]=(n/p>>0)-v&255;return i+h},u.prototype.writeInt8=function(n,i,h){return n=+n,i=i>>>0,h||G(this,n,i,1,127,-128),n<0&&(n=255+n+1),this[i]=n&255,i+1},u.prototype.writeInt16LE=function(n,i,h){return n=+n,i=i>>>0,h||G(this,n,i,2,32767,-32768),this[i]=n&255,this[i+1]=n>>>8,i+2},u.prototype.writeInt16BE=function(n,i,h){return n=+n,i=i>>>0,h||G(this,n,i,2,32767,-32768),this[i]=n>>>8,this[i+1]=n&255,i+2},u.prototype.writeInt32LE=function(n,i,h){return n=+n,i=i>>>0,h||G(this,n,i,4,2147483647,-2147483648),this[i]=n&255,this[i+1]=n>>>8,this[i+2]=n>>>16,this[i+3]=n>>>24,i+4},u.prototype.writeInt32BE=function(n,i,h){return n=+n,i=i>>>0,h||G(this,n,i,4,2147483647,-2147483648),n<0&&(n=4294967295+n+1),this[i]=n>>>24,this[i+1]=n>>>16,this[i+2]=n>>>8,this[i+3]=n&255,i+4},u.prototype.writeBigInt64LE=we(function(n,i=0){return pe(this,n,i,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=we(function(n,i=0){return ze(this,n,i,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function je(l,n,i,h,R,o){if(i+h>l.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function $e(l,n,i,h,R){return n=+n,i=i>>>0,R||je(l,n,i,4),t.write(l,n,i,h,23,4),i+4}u.prototype.writeFloatLE=function(n,i,h){return $e(this,n,i,!0,h)},u.prototype.writeFloatBE=function(n,i,h){return $e(this,n,i,!1,h)};function De(l,n,i,h,R){return n=+n,i=i>>>0,R||je(l,n,i,8),t.write(l,n,i,h,52,8),i+8}u.prototype.writeDoubleLE=function(n,i,h){return De(this,n,i,!0,h)},u.prototype.writeDoubleBE=function(n,i,h){return De(this,n,i,!1,h)},u.prototype.copy=function(n,i,h,R){if(!u.isBuffer(n))throw new TypeError("argument should be a Buffer");if(h||(h=0),!R&&R!==0&&(R=this.length),i>=n.length&&(i=n.length),i||(i=0),R>0&&R<h&&(R=h),R===h||n.length===0||this.length===0)return 0;if(i<0)throw new RangeError("targetStart out of bounds");if(h<0||h>=this.length)throw new RangeError("Index out of range");if(R<0)throw new RangeError("sourceEnd out of bounds");R>this.length&&(R=this.length),n.length-i<R-h&&(R=n.length-i+h);const o=R-h;return this===n&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(i,h,R):Uint8Array.prototype.set.call(n,this.subarray(h,R),i),o},u.prototype.fill=function(n,i,h,R){if(typeof n=="string"){if(typeof i=="string"?(R=i,i=0,h=this.length):typeof h=="string"&&(R=h,h=this.length),R!==void 0&&typeof R!="string")throw new TypeError("encoding must be a string");if(typeof R=="string"&&!u.isEncoding(R))throw new TypeError("Unknown encoding: "+R);if(n.length===1){const p=n.charCodeAt(0);(R==="utf8"&&p<128||R==="latin1")&&(n=p)}}else typeof n=="number"?n=n&255:typeof n=="boolean"&&(n=Number(n));if(i<0||this.length<i||this.length<h)throw new RangeError("Out of range index");if(h<=i)return this;i=i>>>0,h=h===void 0?this.length:h>>>0,n||(n=0);let o;if(typeof n=="number")for(o=i;o<h;++o)this[o]=n;else{const p=u.isBuffer(n)?n:u.from(n,R),v=p.length;if(v===0)throw new TypeError('The value "'+n+'" is invalid for argument "value"');for(o=0;o<h-i;++o)this[o+i]=p[o%v]}return this};const ue={};function xe(l,n,i){ue[l]=class extends i{constructor(){super(),Object.defineProperty(this,"message",{value:n.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${l}]`,this.stack,delete this.name}get code(){return l}set code(R){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:R,writable:!0})}toString(){return`${this.name} [${l}]: ${this.message}`}}}xe("ERR_BUFFER_OUT_OF_BOUNDS",function(l){return l?`${l} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),xe("ERR_INVALID_ARG_TYPE",function(l,n){return`The "${l}" argument must be of type number. Received type ${typeof n}`},TypeError),xe("ERR_OUT_OF_RANGE",function(l,n,i){let h=`The value of "${l}" is out of range.`,R=i;return Number.isInteger(i)&&Math.abs(i)>2**32?R=Le(String(i)):typeof i=="bigint"&&(R=String(i),(i>BigInt(2)**BigInt(32)||i<-(BigInt(2)**BigInt(32)))&&(R=Le(R)),R+="n"),h+=` It must be ${n}. Received ${R}`,h},RangeError);function Le(l){let n="",i=l.length;const h=l[0]==="-"?1:0;for(;i>=h+4;i-=3)n=`_${l.slice(i-3,i)}${n}`;return`${l.slice(0,i)}${n}`}function rr(l,n,i){Me(n,"offset"),(l[n]===void 0||l[n+i]===void 0)&&He(n,l.length-(i+1))}function Dt(l,n,i,h,R,o){if(l>i||l<n){const p=typeof n=="bigint"?"n":"";let v;throw o>3?n===0||n===BigInt(0)?v=`>= 0${p} and < 2${p} ** ${(o+1)*8}${p}`:v=`>= -(2${p} ** ${(o+1)*8-1}${p}) and < 2 ** ${(o+1)*8-1}${p}`:v=`>= ${n}${p} and <= ${i}${p}`,new ue.ERR_OUT_OF_RANGE("value",v,l)}rr(h,R,o)}function Me(l,n){if(typeof l!="number")throw new ue.ERR_INVALID_ARG_TYPE(n,"number",l)}function He(l,n,i){throw Math.floor(l)!==l?(Me(l,i),new ue.ERR_OUT_OF_RANGE(i||"offset","an integer",l)):n<0?new ue.ERR_BUFFER_OUT_OF_BOUNDS:new ue.ERR_OUT_OF_RANGE(i||"offset",`>= ${i?1:0} and <= ${n}`,l)}const nr=/[^+/0-9A-Za-z-_]/g;function ir(l){if(l=l.split("=")[0],l=l.trim().replace(nr,""),l.length<2)return"";for(;l.length%4!==0;)l=l+"=";return l}function _t(l,n){n=n||1/0;let i;const h=l.length;let R=null;const o=[];for(let p=0;p<h;++p){if(i=l.charCodeAt(p),i>55295&&i<57344){if(!R){if(i>56319){(n-=3)>-1&&o.push(239,191,189);continue}else if(p+1===h){(n-=3)>-1&&o.push(239,191,189);continue}R=i;continue}if(i<56320){(n-=3)>-1&&o.push(239,191,189),R=i;continue}i=(R-55296<<10|i-56320)+65536}else R&&(n-=3)>-1&&o.push(239,191,189);if(R=null,i<128){if((n-=1)<0)break;o.push(i)}else if(i<2048){if((n-=2)<0)break;o.push(i>>6|192,i&63|128)}else if(i<65536){if((n-=3)<0)break;o.push(i>>12|224,i>>6&63|128,i&63|128)}else if(i<1114112){if((n-=4)<0)break;o.push(i>>18|240,i>>12&63|128,i>>6&63|128,i&63|128)}else throw new Error("Invalid code point")}return o}function sr(l){const n=[];for(let i=0;i<l.length;++i)n.push(l.charCodeAt(i)&255);return n}function Lt(l,n){let i,h,R;const o=[];for(let p=0;p<l.length&&!((n-=2)<0);++p)i=l.charCodeAt(p),h=i>>8,R=i%256,o.push(R),o.push(h);return o}function Mt(l){return e.toByteArray(ir(l))}function nt(l,n,i,h){let R;for(R=0;R<h&&!(R+i>=n.length||R>=l.length);++R)n[R+i]=l[R];return R}function le(l,n){return l instanceof n||l!=null&&l.constructor!=null&&l.constructor.name!=null&&l.constructor.name===n.name}function it(l){return l!==l}const ar=function(){const l="0123456789abcdef",n=new Array(256);for(let i=0;i<16;++i){const h=i*16;for(let R=0;R<16;++R)n[h+R]=l[i]+l[R]}return n}();function we(l){return typeof BigInt>"u"?or:l}function or(){throw new Error("BigInt not supported")}})(ur);var cr={exports:{}},V=cr.exports={},Ee,ge;function kt(){throw new Error("setTimeout has not been defined")}function qt(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Ee=setTimeout:Ee=kt}catch{Ee=kt}try{typeof clearTimeout=="function"?ge=clearTimeout:ge=qt}catch{ge=qt}})();function dr(r){if(Ee===setTimeout)return setTimeout(r,0);if((Ee===kt||!Ee)&&setTimeout)return Ee=setTimeout,setTimeout(r,0);try{return Ee(r,0)}catch{try{return Ee.call(null,r,0)}catch{return Ee.call(this,r,0)}}}function sn(r){if(ge===clearTimeout)return clearTimeout(r);if((ge===qt||!ge)&&clearTimeout)return ge=clearTimeout,clearTimeout(r);try{return ge(r)}catch{try{return ge.call(null,r)}catch{return ge.call(this,r)}}}var Te=[],Ve=!1,Be,Rt=-1;function an(){!Ve||!Be||(Ve=!1,Be.length?Te=Be.concat(Te):Rt=-1,Te.length&&fr())}function fr(){if(!Ve){var r=dr(an);Ve=!0;for(var e=Te.length;e;){for(Be=Te,Te=[];++Rt<e;)Be&&Be[Rt].run();Rt=-1,e=Te.length}Be=null,Ve=!1,sn(r)}}V.nextTick=function(r){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];Te.push(new hr(r,e)),Te.length===1&&!Ve&&dr(fr)};function hr(r,e){this.fun=r,this.array=e}hr.prototype.run=function(){this.fun.apply(null,this.array)},V.title="browser",V.browser=!0,V.env={},V.argv=[],V.version="",V.versions={};function Se(){}V.on=Se,V.addListener=Se,V.once=Se,V.off=Se,V.removeListener=Se,V.removeAllListeners=Se,V.emit=Se,V.prependListener=Se,V.prependOnceListener=Se,V.listeners=function(r){return[]},V.binding=function(r){throw new Error("process.binding is not supported")},V.cwd=function(){return"/"},V.chdir=function(r){throw new Error("process.chdir is not supported")},V.umask=function(){return 0};var on=cr.exports;(function(r){Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});const e=ur,t=on,s=c=>c&&c.__esModule?c:{default:c},d=s(t),a=globalThis||void 0||self;Object.defineProperty(r,"Buffer",{enumerable:!0,get:()=>e.Buffer}),Object.defineProperty(r,"process",{enumerable:!0,get:()=>d.default}),r.global=a})(B);var zt={exports:{}},jt,pr;function un(){if(pr)return jt;pr=1;var r=1e3,e=r*60,t=e*60,s=t*24,d=s*7,a=s*365.25;jt=function(_,m){m=m||{};var E=typeof _;if(E==="string"&&_.length>0)return c(_);if(E==="number"&&isFinite(_))return m.long?f(_):u(_);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(_))};function c(_){if(_=String(_),!(_.length>100)){var m=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(_);if(m){var E=parseFloat(m[1]),y=(m[2]||"ms").toLowerCase();switch(y){case"years":case"year":case"yrs":case"yr":case"y":return E*a;case"weeks":case"week":case"w":return E*d;case"days":case"day":case"d":return E*s;case"hours":case"hour":case"hrs":case"hr":case"h":return E*t;case"minutes":case"minute":case"mins":case"min":case"m":return E*e;case"seconds":case"second":case"secs":case"sec":case"s":return E*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return E;default:return}}}}function u(_){var m=Math.abs(_);return m>=s?Math.round(_/s)+"d":m>=t?Math.round(_/t)+"h":m>=e?Math.round(_/e)+"m":m>=r?Math.round(_/r)+"s":_+"ms"}function f(_){var m=Math.abs(_);return m>=s?g(_,m,s,"day"):m>=t?g(_,m,t,"hour"):m>=e?g(_,m,e,"minute"):m>=r?g(_,m,r,"second"):_+" ms"}function g(_,m,E,y){var T=m>=E*1.5;return Math.round(_/E)+" "+y+(T?"s":"")}return jt}function ln(r){t.debug=t,t.default=t,t.coerce=f,t.disable=a,t.enable=d,t.enabled=c,t.humanize=un(),t.destroy=g,Object.keys(r).forEach(_=>{t[_]=r[_]}),t.names=[],t.skips=[],t.formatters={};function e(_){let m=0;for(let E=0;E<_.length;E++)m=(m<<5)-m+_.charCodeAt(E),m|=0;return t.colors[Math.abs(m)%t.colors.length]}t.selectColor=e;function t(_){let m,E=null,y,T;function S(...F){if(!S.enabled)return;const b=S,U=Number(new Date),q=U-(m||U);b.diff=q,b.prev=m,b.curr=U,m=U,F[0]=t.coerce(F[0]),typeof F[0]!="string"&&F.unshift("%O");let O=0;F[0]=F[0].replace(/%([a-zA-Z%])/g,(H,te)=>{if(H==="%%")return"%";O++;const re=t.formatters[te];if(typeof re=="function"){const ne=F[O];H=re.call(b,ne),F.splice(O,1),O--}return H}),t.formatArgs.call(b,F),(b.log||t.log).apply(b,F)}return S.namespace=_,S.useColors=t.useColors(),S.color=t.selectColor(_),S.extend=s,S.destroy=t.destroy,Object.defineProperty(S,"enabled",{enumerable:!0,configurable:!1,get:()=>E!==null?E:(y!==t.namespaces&&(y=t.namespaces,T=t.enabled(_)),T),set:F=>{E=F}}),typeof t.init=="function"&&t.init(S),S}function s(_,m){const E=t(this.namespace+(typeof m>"u"?":":m)+_);return E.log=this.log,E}function d(_){t.save(_),t.namespaces=_,t.names=[],t.skips=[];let m;const E=(typeof _=="string"?_:"").split(/[\s,]+/),y=E.length;for(m=0;m<y;m++)E[m]&&(_=E[m].replace(/\*/g,".*?"),_[0]==="-"?t.skips.push(new RegExp("^"+_.slice(1)+"$")):t.names.push(new RegExp("^"+_+"$")))}function a(){const _=[...t.names.map(u),...t.skips.map(u).map(m=>"-"+m)].join(",");return t.enable(""),_}function c(_){if(_[_.length-1]==="*")return!0;let m,E;for(m=0,E=t.skips.length;m<E;m++)if(t.skips[m].test(_))return!1;for(m=0,E=t.names.length;m<E;m++)if(t.names[m].test(_))return!0;return!1}function u(_){return _.toString().substring(2,_.toString().length-2).replace(/\.\*\?$/,"*")}function f(_){return _ instanceof Error?_.stack||_.message:_}function g(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var cn=ln;(function(r,e){e.formatArgs=s,e.save=d,e.load=a,e.useColors=t,e.storage=c(),e.destroy=(()=>{let f=!1;return()=>{f||(f=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(f){if(f[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+f[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const g="color: "+this.color;f.splice(1,0,g,"color: inherit");let _=0,m=0;f[0].replace(/%[a-zA-Z%]/g,E=>{E!=="%%"&&(_++,E==="%c"&&(m=_))}),f.splice(m,0,g)}e.log=console.debug||console.log||(()=>{});function d(f){try{f?e.storage.setItem("debug",f):e.storage.removeItem("debug")}catch{}}function a(){let f;try{f=e.storage.getItem("debug")}catch{}return!f&&typeof B.process<"u"&&"env"in B.process&&(f={}.DEBUG),f}function c(){try{return localStorage}catch{}}r.exports=cn(e);const{formatters:u}=r.exports;u.j=function(f){try{return JSON.stringify(f)}catch(g){return"[UnexpectedJSONParseError]: "+g.message}}})(zt,zt.exports);var dn=zt.exports,ot=Fe(dn);const W=ot("wasmrs");class fn extends Error{matcher(){return new RegExp(this.toString().replace(/^Error: /,""))}}class hn extends fn{constructor(e,t,s){super(`Host call not implemented. Guest called host with binding = '${e}', namespace = '${t}', & operation = '${s}'`)}}var Xe;(function(r){r.OP_LIST="__op_list",r.INIT_BUFFERS="__init_buffers",r.CONSOLE_LOG="__console_log",r.SEND="__send"})(Xe||(Xe={}));var ce;(function(r){r.START="_start",r.OP_LIST_REQUEST="__wasmrs_op_list_request",r.INIT="__wasmrs_init",r.SEND="__wasmrs_send"})(ce||(ce={}));function mr(r){return r[0]<<24|r[1]<<16|r[2]<<8|r[3]}function yr(r){const e=new Uint8Array(4);return e[0]=(r>>24)%256,e[1]=(r>>16)%256,e[2]=(r>>8)%256,e[3]=r%256,e}function pn(r){const e=new Uint8Array(3);return e[0]=r>>8>>8%256,e[1]=r>>8%256,e[2]=r%256,e}function mn(r){return r[0]<<16|r[1]<<8|r[2]}function wt(r){return r[0]<<8|r[1]}class yn{constructor(e,t){j(this,"guestRequest");j(this,"guestResponse");j(this,"hostResponse");j(this,"guestError");j(this,"hostError");j(this,"hostCallback");j(this,"writer");this.hostCallback=e||((s,d,a)=>{throw new hn(s,d,a)}),this.writer=t||(()=>{})}}let $t;class Ce{constructor(e){j(this,"module");this.module=e}static from(e){if(e instanceof Ce)return e;if(e instanceof WebAssembly.Module)return new Ce(e);if("module"in e&&e.module instanceof WebAssembly.Module)return new Ce(e.module);throw new Error(`cannot convert ${e} to WasmRsModule`)}static async compile(e){const t=WebAssembly.compile(e);return new Ce(await t)}static async compileStreaming(e){if(!WebAssembly.compileStreaming){console.warn("WebAssembly.compileStreaming is not supported on this browser, wasm execution will be impacted.");const s=new Uint8Array(await(await e).arrayBuffer());return Ce.compile(s)}const t=WebAssembly.compileStreaming(e);return new Ce(await t)}async instantiate(e={}){const t=new Ht(e);let s;if(e.wasi){if(!$t)throw new Error("Wasi options provided but no WASI implementation found");s=await $t.create(e.wasi)}const d=En(t,s);W("instantiating wasm module");const a=await WebAssembly.instantiate(this.module,d);return s&&s.initialize(a),await t.initialize(a),t}customSection(e){return WebAssembly.Module.customSections(this.module,e)}}class Ht extends EventTarget{constructor(t={}){super();j(this,"guestBufferStart",0);j(this,"hostBufferStart",0);j(this,"state");j(this,"guestSend");j(this,"guestOpListRequest");j(this,"textEncoder");j(this,"textDecoder");j(this,"instance");j(this,"operations",new gr([],[]));this.state=new yn(t.hostCall,t.writer),this.textEncoder=new TextEncoder,this.textDecoder=new TextDecoder("utf-8"),this.guestSend=()=>{},this.guestOpListRequest=()=>{}}static setWasi(t){$t=t}initialize(t){this.instance=t;const s=this.instance.exports[ce.START];s!=null&&(W(">>>",`${ce.START}()`),s([]));const d=this.getProtocolExport(ce.INIT),a=512*1024;W(">>>",`${ce.INIT}(${a},${a},${a})`),d(a,a,a);const c=this.getProtocolExport(ce.OP_LIST_REQUEST);c!=null&&(W(">>>",`${ce.OP_LIST_REQUEST}()`),c()),this.guestSend=this.getProtocolExport(ce.SEND),this.guestOpListRequest=this.getProtocolExport(ce.OP_LIST_REQUEST),W("initialized wasm module")}getProtocolExport(t){const s=this.instance.exports[t];if(s==null)throw new Error(`WebAssembly module does not export ${t}`);return s}send(t){const s=this.getCallerMemory(),d=new Uint8Array(s.buffer);W(`writing ${t.length} bytes to guest memory buffer`,t,this.guestBufferStart),d.set(pn(t.length),this.guestBufferStart),d.set(t,this.guestBufferStart+3),W(">>>",` ${ce.SEND}(${t.length})`),this.guestSend(t.length)}getCallerMemory(){return this.instance.exports.memory}close(){}}function En(r,e){return e?(W("enabling wasi"),{wasi_snapshot_preview1:e.getImports(),wasmrs:Er(r)}):(W("disabling wasi"),{wasmrs:Er(r)})}class gn extends Event{constructor(t,s){super(t);j(this,"payload");this.payload=s}}function Er(r){return{[Xe.CONSOLE_LOG](e,t){W("<<< __console_log %o bytes @ %o",t,e);const d=new Uint8Array(r.getCallerMemory().buffer).slice(e,e+t);console.log(r.textDecoder.decode(d))},[Xe.INIT_BUFFERS](e,t){W("<<< __init_buffers(%o, %o)",e,t),r.guestBufferStart=e,r.hostBufferStart=t},[Xe.SEND](e){W("<<< __send(%o)",e);const s=new Uint8Array(r.getCallerMemory().buffer).slice(r.hostBufferStart,r.hostBufferStart+e);W(`'frame' event: ${s.length} bytes`,Array.from(s).map(c=>c>16&&c<127?String.fromCharCode(c):`\\x${c.toString(16)}`).join(""));let d=!1,a=0;for(;!d;){const c=mn(s.slice(a,3)),u=s.slice(a+3,a+3+c);r.dispatchEvent(new gn("frame",u)),a+=3+c,d=a>=s.length}},[Xe.OP_LIST](e,t){W("<<< __op_list(%o,%o)",e,t);const d=new Uint8Array(r.getCallerMemory().buffer).slice(e,e+t);if(t===0)return;if(d.slice(0,4).toString()!==Rn.toString())throw new Error("invalid op_list magic bytes");const a=wt(d.slice(4,6));if(W("op_list bytes: %o",d),a==1){const c=_n(d.slice(6),r.textDecoder);W("module operations: %o",c),r.operations=c}}}}function _n(r,e){const t=[],s=[];let d=mr(r.slice(0,4));W("decoding %o operations",d);let a=4;for(;d>0;){const c=r[a++],u=r[a++],f=mr(r.slice(a,a+4));a+=4;const g=wt(r.slice(a,a+2));a+=2;const _=e.decode(r.slice(a,a+g));a+=g;const m=wt(r.slice(a,a+2));a+=2;const E=e.decode(r.slice(a,a+m));a+=m;const y=wt(r.slice(a,a+2));a+=2+y;const T=new vn(f,c,_,E);u===1?s.push(T):t.push(T),d--}return new gr(t,s)}class gr{constructor(e,t){j(this,"imports");j(this,"exports");this.imports=e,this.exports=t}getExport(e,t){const s=this.exports.find(d=>d.namespace===e&&d.operation===t);if(!s)throw new Error(`operation ${e}::${t} not found in exports`);return s}getImport(e,t){const s=this.imports.find(d=>d.namespace===e&&d.operation===t);if(!s)throw new Error(`operation ${e}::${t} not found in imports`);return s}}class vn{constructor(e,t,s,d){j(this,"index");j(this,"kind");j(this,"namespace");j(this,"operation");this.index=e,this.kind=t,this.namespace=s,this.operation=d}asEncoded(){const e=yr(this.index),t=new Uint8Array(e.length+4);return t.set(e),t.set(yr(0),e.length),t}}var _r;(function(r){r[r.RR=0]="RR",r[r.FNF=1]="FNF",r[r.RS=2]="RS",r[r.RC=3]="RC"})(_r||(_r={}));const Rn=Uint8Array.from([0,119,114,115]);var Qt={},Vt={},oe={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.Frame=r.Lengths=r.Flags=r.FrameTypes=void 0;var e;(function(t){t[t.RESERVED=0]="RESERVED",t[t.SETUP=1]="SETUP",t[t.LEASE=2]="LEASE",t[t.KEEPALIVE=3]="KEEPALIVE",t[t.REQUEST_RESPONSE=4]="REQUEST_RESPONSE",t[t.REQUEST_FNF=5]="REQUEST_FNF",t[t.REQUEST_STREAM=6]="REQUEST_STREAM",t[t.REQUEST_CHANNEL=7]="REQUEST_CHANNEL",t[t.REQUEST_N=8]="REQUEST_N",t[t.CANCEL=9]="CANCEL",t[t.PAYLOAD=10]="PAYLOAD",t[t.ERROR=11]="ERROR",t[t.METADATA_PUSH=12]="METADATA_PUSH",t[t.RESUME=13]="RESUME",t[t.RESUME_OK=14]="RESUME_OK",t[t.EXT=63]="EXT"})(e=r.FrameTypes||(r.FrameTypes={})),function(t){t[t.NONE=0]="NONE",t[t.COMPLETE=64]="COMPLETE",t[t.FOLLOWS=128]="FOLLOWS",t[t.IGNORE=512]="IGNORE",t[t.LEASE=64]="LEASE",t[t.METADATA=256]="METADATA",t[t.NEXT=32]="NEXT",t[t.RESPOND=128]="RESPOND",t[t.RESUME_ENABLE=128]="RESUME_ENABLE"}(r.Flags||(r.Flags={})),function(t){function s(m){return(m&t.METADATA)===t.METADATA}t.hasMetadata=s;function d(m){return(m&t.COMPLETE)===t.COMPLETE}t.hasComplete=d;function a(m){return(m&t.NEXT)===t.NEXT}t.hasNext=a;function c(m){return(m&t.FOLLOWS)===t.FOLLOWS}t.hasFollows=c;function u(m){return(m&t.IGNORE)===t.IGNORE}t.hasIgnore=u;function f(m){return(m&t.RESPOND)===t.RESPOND}t.hasRespond=f;function g(m){return(m&t.LEASE)===t.LEASE}t.hasLease=g;function _(m){return(m&t.RESUME_ENABLE)===t.RESUME_ENABLE}t.hasResume=_}(r.Flags||(r.Flags={})),function(t){t[t.FRAME=3]="FRAME",t[t.HEADER=6]="HEADER",t[t.METADATA=3]="METADATA",t[t.REQUEST=3]="REQUEST"}(r.Lengths||(r.Lengths={})),function(t){function s(a){return a.streamId===0}t.isConnection=s;function d(a){return e.REQUEST_RESPONSE<=a.type&&a.type<=e.REQUEST_CHANNEL}t.isRequest=d}(r.Frame||(r.Frame={}))})(oe),function(r){var e=C&&C.__generator||function(o,p){var v={label:0,sent:function(){if(A[0]&1)throw A[1];return A[1]},trys:[],ops:[]},w,N,A,x;return x={next:me(0),throw:me(1),return:me(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function me(k){return function(at){return st([k,at])}}function st(k){if(w)throw new TypeError("Generator is already executing.");for(;v;)try{if(w=1,N&&(A=k[0]&2?N.return:k[0]?N.throw||((A=N.return)&&A.call(N),0):N.next)&&!(A=A.call(N,k[1])).done)return A;switch(N=0,A&&(k=[k[0]&2,A.value]),k[0]){case 0:case 1:A=k;break;case 4:return v.label++,{value:k[1],done:!1};case 5:v.label++,N=k[1],k=[0];continue;case 7:k=v.ops.pop(),v.trys.pop();continue;default:if(A=v.trys,!(A=A.length>0&&A[A.length-1])&&(k[0]===6||k[0]===2)){v=0;continue}if(k[0]===3&&(!A||k[1]>A[0]&&k[1]<A[3])){v.label=k[1];break}if(k[0]===6&&v.label<A[1]){v.label=A[1],A=k;break}if(A&&v.label<A[2]){v.label=A[2],v.ops.push(k);break}A[2]&&v.ops.pop(),v.trys.pop();continue}k=p.call(o,v)}catch(at){k=[6,at],N=0}finally{w=A=0}if(k[0]&5)throw k[1];return{value:k[0]?k[1]:void 0,done:!0}}};Object.defineProperty(r,"__esModule",{value:!0}),r.Deserializer=r.sizeOfFrame=r.serializeFrame=r.deserializeFrame=r.serializeFrameWithLength=r.deserializeFrames=r.deserializeFrameWithLength=r.writeUInt64BE=r.readUInt64BE=r.writeUInt24BE=r.readUInt24BE=r.MAX_VERSION=r.MAX_TTL=r.MAX_STREAM_ID=r.MAX_RESUME_LENGTH=r.MAX_REQUEST_N=r.MAX_REQUEST_COUNT=r.MAX_MIME_LENGTH=r.MAX_METADATA_LENGTH=r.MAX_LIFETIME=r.MAX_KEEPALIVE=r.MAX_CODE=r.FRAME_TYPE_OFFFSET=r.FLAGS_MASK=void 0;var t=oe;r.FLAGS_MASK=1023,r.FRAME_TYPE_OFFFSET=10,r.MAX_CODE=2147483647,r.MAX_KEEPALIVE=2147483647,r.MAX_LIFETIME=2147483647,r.MAX_METADATA_LENGTH=16777215,r.MAX_MIME_LENGTH=255,r.MAX_REQUEST_COUNT=2147483647,r.MAX_REQUEST_N=2147483647,r.MAX_RESUME_LENGTH=65535,r.MAX_STREAM_ID=2147483647,r.MAX_TTL=2147483647,r.MAX_VERSION=65535;var s=4294967296;function d(o,p){var v=o.readUInt8(p)<<16,w=o.readUInt8(p+1)<<8,N=o.readUInt8(p+2);return v|w|N}r.readUInt24BE=d;function a(o,p,v){return v=o.writeUInt8(p>>>16,v),v=o.writeUInt8(p>>>8&255,v),o.writeUInt8(p&255,v)}r.writeUInt24BE=a;function c(o,p){var v=o.readUInt32BE(p),w=o.readUInt32BE(p+4);return v*s+w}r.readUInt64BE=c;function u(o,p,v){var w=p/s|0,N=p%s;return v=o.writeUInt32BE(w,v),o.writeUInt32BE(N,v)}r.writeUInt64BE=u;var f=6,g=3;function _(o){var p=d(o,0);return y(o.slice(g,g+p))}r.deserializeFrameWithLength=_;function m(o){var p,v,w,N,A,x;return e(this,function(me){switch(me.label){case 0:p=0,me.label=1;case 1:return p+g<o.length?(v=d(o,p),w=p+g,N=w+v,N>o.length?[3,3]:(A=o.slice(w,N),x=y(A),p=N,[4,[x,p]])):[3,3];case 2:return me.sent(),[3,1];case 3:return[2]}})}r.deserializeFrames=m;function E(o){var p=T(o),v=B.Buffer.allocUnsafe(p.length+g);return a(v,p.length,0),p.copy(v,g),v}r.serializeFrameWithLength=E;function y(o){var p=0,v=o.readInt32BE(p);p+=4;var w=o.readUInt16BE(p);p+=2;var N=w>>>r.FRAME_TYPE_OFFFSET,A=w&r.FLAGS_MASK;switch(N){case t.FrameTypes.SETUP:return O(o,v,A);case t.FrameTypes.PAYLOAD:return sr(o,v,A);case t.FrameTypes.ERROR:return re(o,v,A);case t.FrameTypes.KEEPALIVE:return $(o,v,A);case t.FrameTypes.REQUEST_FNF:return Q(o,v,A);case t.FrameTypes.REQUEST_RESPONSE:return G(o,v,A);case t.FrameTypes.REQUEST_STREAM:return De(o,v,A);case t.FrameTypes.REQUEST_CHANNEL:return ue(o,v,A);case t.FrameTypes.METADATA_PUSH:return pe(o,v,A);case t.FrameTypes.REQUEST_N:return Dt(o,v,A);case t.FrameTypes.RESUME:return le(o,v,A);case t.FrameTypes.RESUME_OK:return or(o,v,A);case t.FrameTypes.CANCEL:return nr(o,v,A);case t.FrameTypes.LEASE:return Ue(o,v,A)}}r.deserializeFrame=y;function T(o){switch(o.type){case t.FrameTypes.SETUP:return U(o);case t.FrameTypes.PAYLOAD:return ir(o);case t.FrameTypes.ERROR:return H(o);case t.FrameTypes.KEEPALIVE:return he(o);case t.FrameTypes.REQUEST_FNF:case t.FrameTypes.REQUEST_RESPONSE:return Pe(o);case t.FrameTypes.REQUEST_STREAM:case t.FrameTypes.REQUEST_CHANNEL:return je(o);case t.FrameTypes.METADATA_PUSH:return qe(o);case t.FrameTypes.REQUEST_N:return Le(o);case t.FrameTypes.RESUME:return Mt(o);case t.FrameTypes.RESUME_OK:return ar(o);case t.FrameTypes.CANCEL:return Me(o);case t.FrameTypes.LEASE:return J(o)}}r.serializeFrame=T;function S(o){switch(o.type){case t.FrameTypes.SETUP:return q(o);case t.FrameTypes.PAYLOAD:return _t(o);case t.FrameTypes.ERROR:return te(o);case t.FrameTypes.KEEPALIVE:return ie(o);case t.FrameTypes.REQUEST_FNF:case t.FrameTypes.REQUEST_RESPONSE:return ke(o);case t.FrameTypes.REQUEST_STREAM:case t.FrameTypes.REQUEST_CHANNEL:return $e(o);case t.FrameTypes.METADATA_PUSH:return rt(o);case t.FrameTypes.REQUEST_N:return rr();case t.FrameTypes.RESUME:return nt(o);case t.FrameTypes.RESUME_OK:return we();case t.FrameTypes.CANCEL:return He();case t.FrameTypes.LEASE:return Ie(o)}}r.sizeOfFrame=S;var F=14,b=2;function U(o){var p=o.resumeToken!=null?o.resumeToken.byteLength:0,v=o.metadataMimeType!=null?B.Buffer.byteLength(o.metadataMimeType,"ascii"):0,w=o.dataMimeType!=null?B.Buffer.byteLength(o.dataMimeType,"ascii"):0,N=n(o),A=B.Buffer.allocUnsafe(f+F+(p?b+p:0)+v+w+N),x=l(o,A);return x=A.writeUInt16BE(o.majorVersion,x),x=A.writeUInt16BE(o.minorVersion,x),x=A.writeUInt32BE(o.keepAlive,x),x=A.writeUInt32BE(o.lifetime,x),o.flags&t.Flags.RESUME_ENABLE&&(x=A.writeUInt16BE(p,x),o.resumeToken!=null&&(x+=o.resumeToken.copy(A,x))),x=A.writeUInt8(v,x),o.metadataMimeType!=null&&(x+=A.write(o.metadataMimeType,x,x+v,"ascii")),x=A.writeUInt8(w,x),o.dataMimeType!=null&&(x+=A.write(o.dataMimeType,x,x+w,"ascii")),i(o,A,x),A}function q(o){var p=o.resumeToken!=null?o.resumeToken.byteLength:0,v=o.metadataMimeType!=null?B.Buffer.byteLength(o.metadataMimeType,"ascii"):0,w=o.dataMimeType!=null?B.Buffer.byteLength(o.dataMimeType,"ascii"):0,N=n(o);return f+F+(p?b+p:0)+v+w+N}function O(o,p,v){o.length;var w=f,N=o.readUInt16BE(w);w+=2;var A=o.readUInt16BE(w);w+=2;var x=o.readInt32BE(w);w+=4;var me=o.readInt32BE(w);w+=4;var st=null;if(v&t.Flags.RESUME_ENABLE){var k=o.readInt16BE(w);w+=2,st=o.slice(w,w+k),w+=k}var at=o.readUInt8(w);w+=1;var wi=o.toString("ascii",w,w+at);w+=at;var Gr=o.readUInt8(w);w+=1;var Fi=o.toString("ascii",w,w+Gr);w+=Gr;var Wr={data:null,dataMimeType:Fi,flags:v,keepAlive:x,lifetime:me,majorVersion:N,metadata:null,metadataMimeType:wi,minorVersion:A,resumeToken:st,streamId:0,type:t.FrameTypes.SETUP};return h(o,Wr,w),Wr}var z=4;function H(o){var p=o.message!=null?B.Buffer.byteLength(o.message,"utf8"):0,v=B.Buffer.allocUnsafe(f+z+p),w=l(o,v);return w=v.writeUInt32BE(o.code,w),o.message!=null&&v.write(o.message,w,w+p,"utf8"),v}function te(o){var p=o.message!=null?B.Buffer.byteLength(o.message,"utf8"):0;return f+z+p}function re(o,p,v){o.length;var w=f,N=o.readInt32BE(w);w+=4;var A=o.length-w,x="";return A>0&&(x=o.toString("utf8",w,w+A),w+=A),{code:N,flags:v,message:x,streamId:p,type:t.FrameTypes.ERROR}}var ne=8;function he(o){var p=o.data!=null?o.data.byteLength:0,v=B.Buffer.allocUnsafe(f+ne+p),w=l(o,v);return w=u(v,o.lastReceivedPosition,w),o.data!=null&&o.data.copy(v,w),v}function ie(o){var p=o.data!=null?o.data.byteLength:0;return f+ne+p}function $(o,p,v){o.length;var w=f,N=c(o,w);w+=8;var A=null;return w<o.length&&(A=o.slice(w,o.length)),{data:A,flags:v,lastReceivedPosition:N,streamId:0,type:t.FrameTypes.KEEPALIVE}}var se=8;function J(o){var p=o.metadata!=null?o.metadata.byteLength:0,v=B.Buffer.allocUnsafe(f+se+p),w=l(o,v);return w=v.writeUInt32BE(o.ttl,w),w=v.writeUInt32BE(o.requestCount,w),o.metadata!=null&&o.metadata.copy(v,w),v}function Ie(o){var p=o.metadata!=null?o.metadata.byteLength:0;return f+se+p}function Ue(o,p,v){var w=f,N=o.readUInt32BE(w);w+=4;var A=o.readUInt32BE(w);w+=4;var x=null;return w<o.length&&(x=o.slice(w,o.length)),{flags:v,metadata:x,requestCount:A,streamId:0,ttl:N,type:t.FrameTypes.LEASE}}function Pe(o){var p=n(o),v=B.Buffer.allocUnsafe(f+p),w=l(o,v);return i(o,v,w),v}function ke(o){var p=n(o);return f+p}function qe(o){var p=o.metadata;if(p!=null){var v=B.Buffer.allocUnsafe(f+p.byteLength),w=l(o,v);return p.copy(v,w),v}else{var v=B.Buffer.allocUnsafe(f);return l(o,v),v}}function rt(o){return f+(o.metadata!=null?o.metadata.byteLength:0)}function Q(o,p,v){o.length;var w={data:null,flags:v,metadata:null,streamId:p,type:t.FrameTypes.REQUEST_FNF};return h(o,w,f),w}function G(o,p,v){var w={data:null,flags:v,metadata:null,streamId:p,type:t.FrameTypes.REQUEST_RESPONSE};return h(o,w,f),w}function pe(o,p,v){return{flags:v,metadata:length===f?null:o.slice(f,length),streamId:0,type:t.FrameTypes.METADATA_PUSH}}var ze=4;function je(o){var p=n(o),v=B.Buffer.allocUnsafe(f+ze+p),w=l(o,v);return w=v.writeUInt32BE(o.requestN,w),i(o,v,w),v}function $e(o){var p=n(o);return f+ze+p}function De(o,p,v){o.length;var w=f,N=o.readInt32BE(w);w+=4;var A={data:null,flags:v,metadata:null,requestN:N,streamId:p,type:t.FrameTypes.REQUEST_STREAM};return h(o,A,w),A}function ue(o,p,v){o.length;var w=f,N=o.readInt32BE(w);w+=4;var A={data:null,flags:v,metadata:null,requestN:N,streamId:p,type:t.FrameTypes.REQUEST_CHANNEL};return h(o,A,w),A}var xe=4;function Le(o){var p=B.Buffer.allocUnsafe(f+xe),v=l(o,p);return p.writeUInt32BE(o.requestN,v),p}function rr(o){return f+xe}function Dt(o,p,v){o.length;var w=o.readInt32BE(f);return{flags:v,requestN:w,streamId:p,type:t.FrameTypes.REQUEST_N}}function Me(o){var p=B.Buffer.allocUnsafe(f);return l(o,p),p}function He(o){return f}function nr(o,p,v){return o.length,{flags:v,streamId:p,type:t.FrameTypes.CANCEL}}function ir(o){var p=n(o),v=B.Buffer.allocUnsafe(f+p),w=l(o,v);return i(o,v,w),v}function _t(o){var p=n(o);return f+p}function sr(o,p,v){o.length;var w={data:null,flags:v,metadata:null,streamId:p,type:t.FrameTypes.PAYLOAD};return h(o,w,f),w}var Lt=22;function Mt(o){var p=o.resumeToken.byteLength,v=B.Buffer.allocUnsafe(f+Lt+p),w=l(o,v);return w=v.writeUInt16BE(o.majorVersion,w),w=v.writeUInt16BE(o.minorVersion,w),w=v.writeUInt16BE(p,w),w+=o.resumeToken.copy(v,w),w=u(v,o.serverPosition,w),u(v,o.clientPosition,w),v}function nt(o){var p=o.resumeToken.byteLength;return f+Lt+p}function le(o,p,v){o.length;var w=f,N=o.readUInt16BE(w);w+=2;var A=o.readUInt16BE(w);w+=2;var x=o.readInt16BE(w);w+=2;var me=o.slice(w,w+x);w+=x;var st=c(o,w);w+=8;var k=c(o,w);return w+=8,{clientPosition:k,flags:v,majorVersion:N,minorVersion:A,resumeToken:me,serverPosition:st,streamId:0,type:t.FrameTypes.RESUME}}var it=8;function ar(o){var p=B.Buffer.allocUnsafe(f+it),v=l(o,p);return u(p,o.clientPosition,v),p}function we(o){return f+it}function or(o,p,v){o.length;var w=c(o,f);return{clientPosition:w,flags:v,streamId:0,type:t.FrameTypes.RESUME_OK}}function l(o,p){var v=p.writeInt32BE(o.streamId,0);return p.writeUInt16BE(o.type<<r.FRAME_TYPE_OFFFSET|o.flags&r.FLAGS_MASK,v)}function n(o){var p=0;return o.data!=null&&(p+=o.data.byteLength),t.Flags.hasMetadata(o.flags)&&(p+=g,o.metadata!=null&&(p+=o.metadata.byteLength)),p}function i(o,p,v){if(t.Flags.hasMetadata(o.flags))if(o.metadata!=null){var w=o.metadata.byteLength;v=a(p,w,v),v+=o.metadata.copy(p,v)}else v=a(p,0,v);o.data!=null&&o.data.copy(p,v)}function h(o,p,v){if(t.Flags.hasMetadata(p.flags)){var w=d(o,v);v+=g,w>0&&(p.metadata=o.slice(v,v+w),v+=w)}v<o.length&&(p.data=o.slice(v,o.length))}var R=function(){function o(){}return o.prototype.deserializeFrame=function(p){return y(p)},o.prototype.deserializeFrameWithLength=function(p){return _(p)},o.prototype.deserializeFrames=function(p){return m(p)},o}();r.Deserializer=R}(Vt);var vr={};Object.defineProperty(vr,"__esModule",{value:!0});var ut={},Rr=C&&C.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],s=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&s>=r.length&&(r=void 0),{value:r&&r[s++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(ut,"__esModule",{value:!0}),ut.Deferred=void 0;var wn=function(){function r(){this._done=!1,this.onCloseCallbacks=[]}return Object.defineProperty(r.prototype,"done",{get:function(){return this._done},enumerable:!1,configurable:!0}),r.prototype.close=function(e){var t,s,d,a;if(this.done){console.warn("Trying to close for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));return}if(this._done=!0,this._error=e,e){try{for(var c=Rr(this.onCloseCallbacks),u=c.next();!u.done;u=c.next()){var f=u.value;f(e)}}catch(m){t={error:m}}finally{try{u&&!u.done&&(s=c.return)&&s.call(c)}finally{if(t)throw t.error}}return}try{for(var g=Rr(this.onCloseCallbacks),_=g.next();!_.done;_=g.next()){var f=_.value;f()}}catch(m){d={error:m}}finally{try{_&&!_.done&&(a=g.return)&&a.call(g)}finally{if(d)throw d.error}}},r.prototype.onClose=function(e){if(this._done){e(this._error);return}this.onCloseCallbacks.push(e)},r}();ut.Deferred=wn;var be={};(function(r){var e=C&&C.__extends||function(){var s=function(d,a){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,u){c.__proto__=u}||function(c,u){for(var f in u)Object.prototype.hasOwnProperty.call(u,f)&&(c[f]=u[f])},s(d,a)};return function(d,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");s(d,a);function c(){this.constructor=d}d.prototype=a===null?Object.create(a):(c.prototype=a.prototype,new c)}}();Object.defineProperty(r,"__esModule",{value:!0}),r.ErrorCodes=r.RSocketError=void 0;var t=function(s){e(d,s);function d(a,c){var u=s.call(this,c)||this;return u.code=a,u}return d}(Error);r.RSocketError=t,function(s){s[s.RESERVED=0]="RESERVED",s[s.INVALID_SETUP=1]="INVALID_SETUP",s[s.UNSUPPORTED_SETUP=2]="UNSUPPORTED_SETUP",s[s.REJECTED_SETUP=3]="REJECTED_SETUP",s[s.REJECTED_RESUME=4]="REJECTED_RESUME",s[s.CONNECTION_CLOSE=258]="CONNECTION_CLOSE",s[s.CONNECTION_ERROR=257]="CONNECTION_ERROR",s[s.APPLICATION_ERROR=513]="APPLICATION_ERROR",s[s.REJECTED=514]="REJECTED",s[s.CANCELED=515]="CANCELED",s[s.INVALID=516]="INVALID",s[s.RESERVED_EXTENSION=4294967295]="RESERVED_EXTENSION"}(r.ErrorCodes||(r.ErrorCodes={}))})(be);var wr={};Object.defineProperty(wr,"__esModule",{value:!0});var lt={},Xt={},Fr;function Tr(){return Fr||(Fr=1,function(r){var e=C&&C.__extends||function(){var m=function(E,y){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,S){T.__proto__=S}||function(T,S){for(var F in S)Object.prototype.hasOwnProperty.call(S,F)&&(T[F]=S[F])},m(E,y)};return function(E,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");m(E,y);function T(){this.constructor=E}E.prototype=y===null?Object.create(y):(T.prototype=y.prototype,new T)}}(),t=C&&C.__awaiter||function(m,E,y,T){function S(F){return F instanceof y?F:new y(function(b){b(F)})}return new(y||(y=Promise))(function(F,b){function U(z){try{O(T.next(z))}catch(H){b(H)}}function q(z){try{O(T.throw(z))}catch(H){b(H)}}function O(z){z.done?F(z.value):S(z.value).then(U,q)}O((T=T.apply(m,E||[])).next())})},s=C&&C.__generator||function(m,E){var y={label:0,sent:function(){if(F[0]&1)throw F[1];return F[1]},trys:[],ops:[]},T,S,F,b;return b={next:U(0),throw:U(1),return:U(2)},typeof Symbol=="function"&&(b[Symbol.iterator]=function(){return this}),b;function U(O){return function(z){return q([O,z])}}function q(O){if(T)throw new TypeError("Generator is already executing.");for(;y;)try{if(T=1,S&&(F=O[0]&2?S.return:O[0]?S.throw||((F=S.return)&&F.call(S),0):S.next)&&!(F=F.call(S,O[1])).done)return F;switch(S=0,F&&(O=[O[0]&2,F.value]),O[0]){case 0:case 1:F=O;break;case 4:return y.label++,{value:O[1],done:!1};case 5:y.label++,S=O[1],O=[0];continue;case 7:O=y.ops.pop(),y.trys.pop();continue;default:if(F=y.trys,!(F=F.length>0&&F[F.length-1])&&(O[0]===6||O[0]===2)){y=0;continue}if(O[0]===3&&(!F||O[1]>F[0]&&O[1]<F[3])){y.label=O[1];break}if(O[0]===6&&y.label<F[1]){y.label=F[1],F=O;break}if(F&&y.label<F[2]){y.label=F[2],y.ops.push(O);break}F[2]&&y.ops.pop(),y.trys.pop();continue}O=E.call(m,y)}catch(z){O=[6,z],S=0}finally{T=F=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}};Object.defineProperty(r,"__esModule",{value:!0}),r.ResumeOkAwaitingResumableClientServerInputMultiplexerDemultiplexer=r.ResumableClientServerInputMultiplexerDemultiplexer=r.ClientServerInputMultiplexerDemultiplexer=r.StreamIdGenerator=void 0;var d=Wt(),a=ut,c=be,u=oe;(function(m){function E(T){return new y(T)}m.create=E;var y=function(){function T(S){this.currentId=S}return T.prototype.next=function(S){var F=this.currentId+2;S(F)&&(this.currentId=F)},T}()})(r.StreamIdGenerator||(r.StreamIdGenerator={}));var f=function(m){e(E,m);function E(y,T,S){var F=m.call(this)||this;return F.streamIdSupplier=y,F.outbound=T,F.closeable=S,F.registry={},S.onClose(F.close.bind(F)),F}return E.prototype.handle=function(y){if(u.Frame.isConnection(y)){if(y.type===d.FrameTypes.RESERVED)return;this.connectionFramesHandler.handle(y)}else if(u.Frame.isRequest(y)){if(this.registry[y.streamId])return;this.requestFramesHandler.handle(y,this)}else{var T=this.registry[y.streamId];if(!T)return;T.handle(y)}},E.prototype.connectionInbound=function(y){if(this.connectionFramesHandler)throw new Error("Connection frame handler has already been installed");this.connectionFramesHandler=y},E.prototype.handleRequestStream=function(y){if(this.requestFramesHandler)throw new Error("Stream handler has already been installed");this.requestFramesHandler=y},E.prototype.send=function(y){this.outbound.send(y)},Object.defineProperty(E.prototype,"connectionOutbound",{get:function(){return this},enumerable:!1,configurable:!0}),E.prototype.createRequestStream=function(y){var T=this;if(this.done){y.handleReject(new Error("Already closed"));return}var S=this.registry;this.streamIdSupplier.next(function(F){return y.handleReady(F,T)},Object.keys(S))},E.prototype.connect=function(y){this.registry[y.streamId]=y},E.prototype.disconnect=function(y){delete this.registry[y.streamId]},E.prototype.close=function(y){if(this.done){m.prototype.close.call(this,y);return}for(var T in this.registry){var S=this.registry[T];S.close(new Error("Closed. ".concat(y?"Original cause [".concat(y,"]."):"")))}m.prototype.close.call(this,y)},E}(a.Deferred);r.ClientServerInputMultiplexerDemultiplexer=f;var g=function(m){e(E,m);function E(y,T,S,F,b,U,q){var O=m.call(this,y,T,new a.Deferred)||this;return O.frameStore=F,O.token=b,O.sessionTimeout=q,U instanceof Function?O.reconnector=U:O.sessionStore=U,S.onClose(O.handleConnectionClose.bind(O)),O}return E.prototype.send=function(y){if(u.Frame.isConnection(y)){if(y.type===d.FrameTypes.KEEPALIVE)y.lastReceivedPosition=this.frameStore.lastReceivedFramePosition;else if(y.type===d.FrameTypes.ERROR){this.outbound.send(y),this.sessionStore&&delete this.sessionStore[this.token],m.prototype.close.call(this,new c.RSocketError(y.code,y.message));return}}else this.frameStore.store(y);this.outbound.send(y)},E.prototype.handle=function(y){if(u.Frame.isConnection(y)){if(y.type===d.FrameTypes.KEEPALIVE)try{this.frameStore.dropTo(y.lastReceivedPosition)}catch(T){this.outbound.send({type:d.FrameTypes.ERROR,streamId:0,flags:d.Flags.NONE,code:T.code,message:T.message}),this.close(T)}else if(y.type===d.FrameTypes.ERROR){m.prototype.handle.call(this,y),this.sessionStore&&delete this.sessionStore[this.token],m.prototype.close.call(this,new c.RSocketError(y.code,y.message));return}}else this.frameStore.record(y);m.prototype.handle.call(this,y)},E.prototype.resume=function(y,T,S){switch(this.outbound=T,y.type){case d.FrameTypes.RESUME:{if(clearTimeout(this.timeoutId),this.frameStore.lastReceivedFramePosition<y.clientPosition){var F=new c.RSocketError(d.ErrorCodes.REJECTED_RESUME,"Impossible to resume since first available client frame position is greater than last received server frame position");this.outbound.send({type:d.FrameTypes.ERROR,streamId:0,flags:d.Flags.NONE,code:F.code,message:F.message}),this.close(F);return}try{this.frameStore.dropTo(y.serverPosition)}catch(b){this.outbound.send({type:d.FrameTypes.ERROR,streamId:0,flags:d.Flags.NONE,code:b.code,message:b.message}),this.close(b);return}this.outbound.send({type:d.FrameTypes.RESUME_OK,streamId:0,flags:d.Flags.NONE,clientPosition:this.frameStore.lastReceivedFramePosition});break}case d.FrameTypes.RESUME_OK:{try{this.frameStore.dropTo(y.clientPosition)}catch(b){this.outbound.send({type:d.FrameTypes.ERROR,streamId:0,flags:d.Flags.NONE,code:b.code,message:b.message}),this.close(b)}break}}this.frameStore.drain(this.outbound.send.bind(this.outbound)),S.onClose(this.handleConnectionClose.bind(this)),this.connectionFramesHandler.resume()},E.prototype.handleConnectionClose=function(y){return t(this,void 0,void 0,function(){var T;return s(this,function(S){switch(S.label){case 0:if(this.connectionFramesHandler.pause(),!this.reconnector)return[3,5];S.label=1;case 1:return S.trys.push([1,3,,4]),[4,this.reconnector(this,this.frameStore)];case 2:return S.sent(),[3,4];case 3:return T=S.sent(),this.close(T),[3,4];case 4:return[3,6];case 5:this.timeoutId=setTimeout(this.close.bind(this),this.sessionTimeout),S.label=6;case 6:return[2]}})})},E}(f);r.ResumableClientServerInputMultiplexerDemultiplexer=g;var _=function(){function m(E,y,T){this.outbound=E,this.closeable=y,this.delegate=T,this.resumed=!1}return m.prototype.close=function(){this.delegate.close()},m.prototype.onClose=function(E){this.delegate.onClose(E)},Object.defineProperty(m.prototype,"connectionOutbound",{get:function(){return this.delegate.connectionOutbound},enumerable:!1,configurable:!0}),m.prototype.createRequestStream=function(E){this.delegate.createRequestStream(E)},m.prototype.connectionInbound=function(E){this.delegate.connectionInbound(E)},m.prototype.handleRequestStream=function(E){this.delegate.handleRequestStream(E)},m.prototype.handle=function(E){var y=this;if(!this.resumed){if(E.type===d.FrameTypes.RESUME_OK){this.resumed=!0,this.delegate.resume(E,this.outbound,this.closeable);return}else this.outbound.send({type:d.FrameTypes.ERROR,streamId:0,code:d.ErrorCodes.CONNECTION_ERROR,message:"Incomplete RESUME handshake. Unexpected frame ".concat(E.type," received"),flags:d.Flags.NONE}),this.closeable.close(),this.closeable.onClose(function(){return y.delegate.close(new c.RSocketError(d.ErrorCodes.CONNECTION_ERROR,"Incomplete RESUME handshake. Unexpected frame ".concat(E.type," received")))});return}this.delegate.handle(E)},m}();r.ResumeOkAwaitingResumableClientServerInputMultiplexerDemultiplexer=_}(Xt)),Xt}var K={},Ge={},de={},Sr=C&&C.__generator||function(r,e){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},s,d,a,c;return c={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function u(g){return function(_){return f([g,_])}}function f(g){if(s)throw new TypeError("Generator is already executing.");for(;t;)try{if(s=1,d&&(a=g[0]&2?d.return:g[0]?d.throw||((a=d.return)&&a.call(d),0):d.next)&&!(a=a.call(d,g[1])).done)return a;switch(d=0,a&&(g=[g[0]&2,a.value]),g[0]){case 0:case 1:a=g;break;case 4:return t.label++,{value:g[1],done:!1};case 5:t.label++,d=g[1],g=[0];continue;case 7:g=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(g[0]===6||g[0]===2)){t=0;continue}if(g[0]===3&&(!a||g[1]>a[0]&&g[1]<a[3])){t.label=g[1];break}if(g[0]===6&&t.label<a[1]){t.label=a[1],a=g;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(g);break}a[2]&&t.ops.pop(),t.trys.pop();continue}g=e.call(r,t)}catch(_){g=[6,_],d=0}finally{s=a=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(de,"__esModule",{value:!0}),de.fragmentWithRequestN=de.fragment=de.isFragmentable=void 0;var L=oe;function Fn(r,e,t){return e===0?!1:r.data.byteLength+(r.metadata?r.metadata.byteLength+L.Lengths.METADATA:0)+(t==L.FrameTypes.REQUEST_STREAM||t==L.FrameTypes.REQUEST_CHANNEL?L.Lengths.REQUEST:0)>e}de.isFragmentable=Fn;function Tn(r,e,t,s,d){var a,c,u,f,g,_,m,m,E,y,T,T,S,F;return d===void 0&&(d=!1),Sr(this,function(b){switch(b.label){case 0:return a=(F=(S=e.data)===null||S===void 0?void 0:S.byteLength)!==null&&F!==void 0?F:0,c=s!==L.FrameTypes.PAYLOAD,u=t,e.metadata?(g=e.metadata.byteLength,g!==0?[3,1]:(u-=L.Lengths.METADATA,f=B.Buffer.allocUnsafe(0),[3,6])):[3,6];case 1:return _=0,c?(u-=L.Lengths.METADATA,m=Math.min(g,_+u),f=e.metadata.slice(_,m),u-=f.byteLength,_=m,u!==0?[3,3]:(c=!1,[4,{type:s,flags:L.Flags.FOLLOWS|L.Flags.METADATA,data:void 0,metadata:f,streamId:r}])):[3,3];case 2:b.sent(),f=void 0,u=t,b.label=3;case 3:return _<g?(u-=L.Lengths.METADATA,m=Math.min(g,_+u),f=e.metadata.slice(_,m),u-=f.byteLength,_=m,u===0||a===0?[4,{type:L.FrameTypes.PAYLOAD,flags:L.Flags.NEXT|L.Flags.METADATA|(_===g&&d&&a===0?L.Flags.COMPLETE:L.Flags.FOLLOWS),data:void 0,metadata:f,streamId:r}]:[3,5]):[3,6];case 4:b.sent(),f=void 0,u=t,b.label=5;case 5:return[3,3];case 6:return E=0,c?(T=Math.min(a,E+u),y=e.data.slice(E,T),u-=y.byteLength,E=T,[4,{type:s,flags:L.Flags.FOLLOWS|(f?L.Flags.METADATA:L.Flags.NONE),data:y,metadata:f,streamId:r}]):[3,8];case 7:b.sent(),f=void 0,y=void 0,u=t,b.label=8;case 8:return E<a?(T=Math.min(a,E+u),y=e.data.slice(E,T),u-=y.byteLength,E=T,[4,{type:L.FrameTypes.PAYLOAD,flags:E===a?(d?L.Flags.COMPLETE:L.Flags.NONE)|L.Flags.NEXT|(f?L.Flags.METADATA:0):L.Flags.FOLLOWS|L.Flags.NEXT|(f?L.Flags.METADATA:0),data:y,metadata:f,streamId:r}]):[3,10];case 9:return b.sent(),f=void 0,y=void 0,u=t,[3,8];case 10:return[2]}})}de.fragment=Tn;function Sn(r,e,t,s,d,a){var c,u,f,g,_,m,E,E,y,T,S,S,F,b;return a===void 0&&(a=!1),Sr(this,function(U){switch(U.label){case 0:return c=(b=(F=e.data)===null||F===void 0?void 0:F.byteLength)!==null&&b!==void 0?b:0,u=!0,f=t,e.metadata?(_=e.metadata.byteLength,_!==0?[3,1]:(f-=L.Lengths.METADATA,g=B.Buffer.allocUnsafe(0),[3,6])):[3,6];case 1:return m=0,u?(f-=L.Lengths.METADATA+L.Lengths.REQUEST,E=Math.min(_,m+f),g=e.metadata.slice(m,E),f-=g.byteLength,m=E,f!==0?[3,3]:(u=!1,[4,{type:s,flags:L.Flags.FOLLOWS|L.Flags.METADATA,data:void 0,requestN:d,metadata:g,streamId:r}])):[3,3];case 2:U.sent(),g=void 0,f=t,U.label=3;case 3:return m<_?(f-=L.Lengths.METADATA,E=Math.min(_,m+f),g=e.metadata.slice(m,E),f-=g.byteLength,m=E,f===0||c===0?[4,{type:L.FrameTypes.PAYLOAD,flags:L.Flags.NEXT|L.Flags.METADATA|(m===_&&a&&c===0?L.Flags.COMPLETE:L.Flags.FOLLOWS),data:void 0,metadata:g,streamId:r}]:[3,5]):[3,6];case 4:U.sent(),g=void 0,f=t,U.label=5;case 5:return[3,3];case 6:return y=0,u?(f-=L.Lengths.REQUEST,S=Math.min(c,y+f),T=e.data.slice(y,S),f-=T.byteLength,y=S,[4,{type:s,flags:L.Flags.FOLLOWS|(g?L.Flags.METADATA:L.Flags.NONE),data:T,requestN:d,metadata:g,streamId:r}]):[3,8];case 7:U.sent(),g=void 0,T=void 0,f=t,U.label=8;case 8:return y<c?(S=Math.min(c,y+f),T=e.data.slice(y,S),f-=T.byteLength,y=S,[4,{type:L.FrameTypes.PAYLOAD,flags:y===c?(a?L.Flags.COMPLETE:L.Flags.NONE)|L.Flags.NEXT|(g?L.Flags.METADATA:0):L.Flags.FOLLOWS|L.Flags.NEXT|(g?L.Flags.METADATA:0),data:T,metadata:g,streamId:r}]):[3,10];case 9:return U.sent(),g=void 0,T=void 0,f=t,[3,8];case 10:return[2]}})}de.fragmentWithRequestN=Sn;var fe={};Object.defineProperty(fe,"__esModule",{value:!0}),fe.cancel=fe.reassemble=fe.add=void 0;function bn(r,e,t){return r.hasFragments?(r.data=r.data?B.Buffer.concat([r.data,e]):e,r.metadata&&t&&(r.metadata=B.Buffer.concat([r.metadata,t])),!0):(r.hasFragments=!0,r.data=e,t&&(r.metadata=t),!0)}fe.add=bn;function An(r,e,t){r.hasFragments=!1;var s=r.data?B.Buffer.concat([r.data,e]):e;if(r.data=void 0,r.metadata){var d=t?B.Buffer.concat([r.metadata,t]):r.metadata;return r.metadata=void 0,{data:s,metadata:d}}return{data:s}}fe.reassemble=An;function In(r){r.hasFragments=!1,r.data=void 0,r.metadata=void 0}fe.cancel=In;var xn=C&&C.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t),Object.defineProperty(r,s,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),Cn=C&&C.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Nn=C&&C.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&xn(e,r,t);return Cn(e,r),e},Gt=C&&C.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],s=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&s>=r.length&&(r=void 0),{value:r&&r[s++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.RequestChannelResponderStream=Ge.RequestChannelRequesterStream=void 0;var Z=be,We=de,I=oe,_e=Nn(fe),On=function(){function r(e,t,s,d,a,c){this.payload=e,this.isComplete=t,this.receiver=s,this.fragmentSize=d,this.initialRequestN=a,this.leaseManager=c,this.streamType=I.FrameTypes.REQUEST_CHANNEL}return r.prototype.handleReady=function(e,t){var s,d;if(this.outboundDone)return!1;this.streamId=e,this.stream=t,t.connect(this);var a=this.isComplete;if(a&&(this.outboundDone=a),(0,We.isFragmentable)(this.payload,this.fragmentSize,I.FrameTypes.REQUEST_CHANNEL))try{for(var c=Gt((0,We.fragmentWithRequestN)(e,this.payload,this.fragmentSize,I.FrameTypes.REQUEST_CHANNEL,this.initialRequestN,a)),u=c.next();!u.done;u=c.next()){var f=u.value;this.stream.send(f)}}catch(g){s={error:g}}finally{try{u&&!u.done&&(d=c.return)&&d.call(c)}finally{if(s)throw s.error}}else this.stream.send({type:I.FrameTypes.REQUEST_CHANNEL,data:this.payload.data,metadata:this.payload.metadata,requestN:this.initialRequestN,flags:(this.payload.metadata!==void 0?I.Flags.METADATA:I.Flags.NONE)|(a?I.Flags.COMPLETE:I.Flags.NONE),streamId:e});return this.hasExtension&&this.stream.send({type:I.FrameTypes.EXT,streamId:e,extendedContent:this.extendedContent,extendedType:this.extendedType,flags:this.flags}),!0},r.prototype.handleReject=function(e){this.inboundDone||(this.inboundDone=!0,this.outboundDone=!0,this.receiver.onError(e))},r.prototype.handle=function(e){var t,s=e.type;switch(s){case I.FrameTypes.PAYLOAD:{var d=I.Flags.hasComplete(e.flags),a=I.Flags.hasNext(e.flags);if(d||!I.Flags.hasFollows(e.flags)){if(d&&(this.inboundDone=!0,this.outboundDone&&this.stream.disconnect(this),!a)){this.receiver.onComplete();return}var c=this.hasFragments?_e.reassemble(this,e.data,e.metadata):{data:e.data,metadata:e.metadata};this.receiver.onNext(c,d);return}if(_e.add(this,e.data,e.metadata))return;t="Unexpected frame size";break}case I.FrameTypes.CANCEL:{if(this.outboundDone)return;this.outboundDone=!0,this.inboundDone&&this.stream.disconnect(this),this.receiver.cancel();return}case I.FrameTypes.REQUEST_N:{if(this.outboundDone)return;if(this.hasFragments){t="Unexpected frame type [".concat(s,"] during reassembly");break}this.receiver.request(e.requestN);return}case I.FrameTypes.ERROR:{var u=this.outboundDone;this.inboundDone=!0,this.outboundDone=!0,this.stream.disconnect(this),_e.cancel(this),u||this.receiver.cancel(),this.receiver.onError(new Z.RSocketError(e.code,e.message));return}case I.FrameTypes.EXT:this.receiver.onExtension(e.extendedType,e.extendedContent,I.Flags.hasIgnore(e.flags));return;default:t="Unexpected frame type [".concat(s,"]")}this.close(new Z.RSocketError(Z.ErrorCodes.CANCELED,t)),this.stream.send({type:I.FrameTypes.CANCEL,streamId:this.streamId,flags:I.Flags.NONE}),this.stream.disconnect(this)},r.prototype.request=function(e){if(!this.inboundDone){if(!this.streamId){this.initialRequestN+=e;return}this.stream.send({type:I.FrameTypes.REQUEST_N,flags:I.Flags.NONE,requestN:e,streamId:this.streamId})}},r.prototype.cancel=function(){var e,t=this.inboundDone,s=this.outboundDone;if(!(t&&s)){if(this.inboundDone=!0,this.outboundDone=!0,s||this.receiver.cancel(),!this.streamId){(e=this.leaseManager)===null||e===void 0||e.cancelRequest(this);return}this.stream.send({type:t?I.FrameTypes.ERROR:I.FrameTypes.CANCEL,flags:I.Flags.NONE,streamId:this.streamId,code:Z.ErrorCodes.CANCELED,message:"Cancelled"}),this.stream.disconnect(this),_e.cancel(this)}},r.prototype.onNext=function(e,t){var s,d;if(!this.outboundDone)if(t&&(this.outboundDone=!0,this.inboundDone&&this.stream.disconnect(this)),(0,We.isFragmentable)(e,this.fragmentSize,I.FrameTypes.PAYLOAD))try{for(var a=Gt((0,We.fragment)(this.streamId,e,this.fragmentSize,I.FrameTypes.PAYLOAD,t)),c=a.next();!c.done;c=a.next()){var u=c.value;this.stream.send(u)}}catch(f){s={error:f}}finally{try{c&&!c.done&&(d=a.return)&&d.call(a)}finally{if(s)throw s.error}}else this.stream.send({type:I.FrameTypes.PAYLOAD,streamId:this.streamId,flags:I.Flags.NEXT|(e.metadata?I.Flags.METADATA:I.Flags.NONE)|(t?I.Flags.COMPLETE:I.Flags.NONE),data:e.data,metadata:e.metadata})},r.prototype.onComplete=function(){if(!this.streamId){this.isComplete=!0;return}this.outboundDone||(this.outboundDone=!0,this.stream.send({type:I.FrameTypes.PAYLOAD,streamId:this.streamId,flags:I.Flags.COMPLETE,data:null,metadata:null}),this.inboundDone&&this.stream.disconnect(this))},r.prototype.onError=function(e){if(!this.outboundDone){var t=this.inboundDone;this.outboundDone=!0,this.inboundDone=!0,this.stream.send({type:I.FrameTypes.ERROR,streamId:this.streamId,flags:I.Flags.NONE,code:e instanceof Z.RSocketError?e.code:Z.ErrorCodes.APPLICATION_ERROR,message:e.message}),this.stream.disconnect(this),t||this.receiver.onError(e)}},r.prototype.onExtension=function(e,t,s){if(!this.outboundDone){if(!this.streamId){this.hasExtension=!0,this.extendedType=e,this.extendedContent=t,this.flags=s?I.Flags.IGNORE:I.Flags.NONE;return}this.stream.send({streamId:this.streamId,type:I.FrameTypes.EXT,extendedType:e,extendedContent:t,flags:s?I.Flags.IGNORE:I.Flags.NONE})}},r.prototype.close=function(e){if(!(this.inboundDone&&this.outboundDone)){var t=this.inboundDone,s=this.outboundDone;this.inboundDone=!0,this.outboundDone=!0,_e.cancel(this),s||this.receiver.cancel(),t||(e?this.receiver.onError(e):this.receiver.onComplete())}},r}();Ge.RequestChannelRequesterStream=On;var Un=function(){function r(e,t,s,d,a){if(this.streamId=e,this.stream=t,this.fragmentSize=s,this.handler=d,this.streamType=I.FrameTypes.REQUEST_CHANNEL,t.connect(this),I.Flags.hasFollows(a.flags)){_e.add(this,a.data,a.metadata),this.initialRequestN=a.requestN,this.isComplete=I.Flags.hasComplete(a.flags);return}var c={data:a.data,metadata:a.metadata},u=I.Flags.hasComplete(a.flags);this.inboundDone=u;try{this.receiver=d(c,a.requestN,u,this),this.outboundDone&&this.defferedError&&this.receiver.onError(this.defferedError)}catch(f){this.outboundDone&&!this.inboundDone?this.cancel():this.inboundDone=!0,this.onError(f)}}return r.prototype.handle=function(e){var t,s=e.type;switch(s){case I.FrameTypes.PAYLOAD:{if(I.Flags.hasFollows(e.flags)){if(_e.add(this,e.data,e.metadata))return;t="Unexpected frame size";break}var d=this.hasFragments?_e.reassemble(this,e.data,e.metadata):{data:e.data,metadata:e.metadata},a=I.Flags.hasComplete(e.flags);if(this.receiver){if(a&&(this.inboundDone=!0,this.outboundDone&&this.stream.disconnect(this),!I.Flags.hasNext(e.flags))){this.receiver.onComplete();return}this.receiver.onNext(d,a)}else{var c=this.isComplete||a;c&&(this.inboundDone=!0,this.outboundDone&&this.stream.disconnect(this));try{this.receiver=this.handler(d,this.initialRequestN,c,this),this.outboundDone&&this.defferedError}catch(g){this.outboundDone&&!this.inboundDone?this.cancel():this.inboundDone=!0,this.onError(g)}}return}case I.FrameTypes.REQUEST_N:{if(!this.receiver||this.hasFragments){t="Unexpected frame type [".concat(s,"] during reassembly");break}this.receiver.request(e.requestN);return}case I.FrameTypes.ERROR:case I.FrameTypes.CANCEL:{var c=this.inboundDone,u=this.outboundDone;if(this.inboundDone=!0,this.outboundDone=!0,this.stream.disconnect(this),_e.cancel(this),!this.receiver)return;if(u||this.receiver.cancel(),!c){var f=s===I.FrameTypes.CANCEL?new Z.RSocketError(Z.ErrorCodes.CANCELED,"Cancelled"):new Z.RSocketError(e.code,e.message);this.receiver.onError(f)}return}case I.FrameTypes.EXT:{if(!this.receiver||this.hasFragments){t="Unexpected frame type [".concat(s,"] during reassembly");break}this.receiver.onExtension(e.extendedType,e.extendedContent,I.Flags.hasIgnore(e.flags));return}default:t="Unexpected frame type [".concat(s,"]")}this.stream.send({type:I.FrameTypes.ERROR,flags:I.Flags.NONE,code:Z.ErrorCodes.CANCELED,message:t,streamId:this.streamId}),this.stream.disconnect(this),this.close(new Z.RSocketError(Z.ErrorCodes.CANCELED,t))},r.prototype.onError=function(e){if(this.outboundDone){console.warn("Trying to error for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));return}var t=this.inboundDone;this.outboundDone=!0,this.inboundDone=!0,this.stream.send({type:I.FrameTypes.ERROR,flags:I.Flags.NONE,code:e instanceof Z.RSocketError?e.code:Z.ErrorCodes.APPLICATION_ERROR,message:e.message,streamId:this.streamId}),this.stream.disconnect(this),t||(this.receiver?this.receiver.onError(e):this.defferedError=e)},r.prototype.onNext=function(e,t){var s,d;if(!this.outboundDone){if(t&&(this.outboundDone=!0),(0,We.isFragmentable)(e,this.fragmentSize,I.FrameTypes.PAYLOAD))try{for(var a=Gt((0,We.fragment)(this.streamId,e,this.fragmentSize,I.FrameTypes.PAYLOAD,t)),c=a.next();!c.done;c=a.next()){var u=c.value;this.stream.send(u)}}catch(f){s={error:f}}finally{try{c&&!c.done&&(d=a.return)&&d.call(a)}finally{if(s)throw s.error}}else this.stream.send({type:I.FrameTypes.PAYLOAD,flags:I.Flags.NEXT|(t?I.Flags.COMPLETE:I.Flags.NONE)|(e.metadata?I.Flags.METADATA:I.Flags.NONE),data:e.data,metadata:e.metadata,streamId:this.streamId});t&&this.inboundDone&&this.stream.disconnect(this)}},r.prototype.onComplete=function(){this.outboundDone||(this.outboundDone=!0,this.stream.send({type:I.FrameTypes.PAYLOAD,flags:I.Flags.COMPLETE,streamId:this.streamId,data:null,metadata:null}),this.inboundDone&&this.stream.disconnect(this))},r.prototype.onExtension=function(e,t,s){this.outboundDone&&this.inboundDone||this.stream.send({type:I.FrameTypes.EXT,streamId:this.streamId,flags:s?I.Flags.IGNORE:I.Flags.NONE,extendedType:e,extendedContent:t})},r.prototype.request=function(e){this.inboundDone||this.stream.send({type:I.FrameTypes.REQUEST_N,flags:I.Flags.NONE,streamId:this.streamId,requestN:e})},r.prototype.cancel=function(){this.inboundDone||(this.inboundDone=!0,this.stream.send({type:I.FrameTypes.CANCEL,flags:I.Flags.NONE,streamId:this.streamId}),this.outboundDone&&this.stream.disconnect(this))},r.prototype.close=function(e){if(this.inboundDone&&this.outboundDone){console.warn("Trying to close for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));return}var t=this.inboundDone,s=this.outboundDone;this.inboundDone=!0,this.outboundDone=!0,_e.cancel(this);var d=this.receiver;d&&(s||d.cancel(),t||(e?d.onError(e):d.onComplete()))},r}();Ge.RequestChannelResponderStream=Un;var Ye={},Dn=C&&C.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t),Object.defineProperty(r,s,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),Ln=C&&C.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Mn=C&&C.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Dn(e,r,t);return Ln(e,r),e},Bn=C&&C.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],s=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&s>=r.length&&(r=void 0),{value:r&&r[s++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.RequestFnfResponderStream=Ye.RequestFnFRequesterStream=void 0;var Ft=be,br=de,ee=oe,ct=Mn(fe),Pn=function(){function r(e,t,s,d){this.payload=e,this.receiver=t,this.fragmentSize=s,this.leaseManager=d,this.streamType=ee.FrameTypes.REQUEST_FNF}return r.prototype.handleReady=function(e,t){var s,d;if(this.done)return!1;if(this.streamId=e,(0,br.isFragmentable)(this.payload,this.fragmentSize,ee.FrameTypes.REQUEST_FNF))try{for(var a=Bn((0,br.fragment)(e,this.payload,this.fragmentSize,ee.FrameTypes.REQUEST_FNF)),c=a.next();!c.done;c=a.next()){var u=c.value;t.send(u)}}catch(f){s={error:f}}finally{try{c&&!c.done&&(d=a.return)&&d.call(a)}finally{if(s)throw s.error}}else t.send({type:ee.FrameTypes.REQUEST_FNF,data:this.payload.data,metadata:this.payload.metadata,flags:this.payload.metadata?ee.Flags.METADATA:0,streamId:e});return this.done=!0,this.receiver.onComplete(),!0},r.prototype.handleReject=function(e){this.done||(this.done=!0,this.receiver.onError(e))},r.prototype.cancel=function(){var e;this.done||(this.done=!0,(e=this.leaseManager)===null||e===void 0||e.cancelRequest(this))},r.prototype.handle=function(e){if(e.type==ee.FrameTypes.ERROR){this.close(new Ft.RSocketError(e.code,e.message));return}this.close(new Ft.RSocketError(Ft.ErrorCodes.CANCELED,"Received invalid frame"))},r.prototype.close=function(e){if(this.done){console.warn("Trying to close for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));return}e?this.receiver.onError(e):this.receiver.onComplete()},r}();Ye.RequestFnFRequesterStream=Pn;var kn=function(){function r(e,t,s,d){if(this.streamId=e,this.stream=t,this.handler=s,this.streamType=ee.FrameTypes.REQUEST_FNF,ee.Flags.hasFollows(d.flags)){ct.add(this,d.data,d.metadata),t.connect(this);return}var a={data:d.data,metadata:d.metadata};try{this.cancellable=s(a,this)}catch{}}return r.prototype.handle=function(e){var t;if(e.type==ee.FrameTypes.PAYLOAD)if(ee.Flags.hasFollows(e.flags)){if(ct.add(this,e.data,e.metadata))return;t="Unexpected fragment size"}else{this.stream.disconnect(this);var s=ct.reassemble(this,e.data,e.metadata);try{this.cancellable=this.handler(s,this)}catch{}return}else t="Unexpected frame type [".concat(e.type,"]");this.done=!0,e.type!=ee.FrameTypes.CANCEL&&e.type!=ee.FrameTypes.ERROR&&this.stream.send({type:ee.FrameTypes.ERROR,streamId:this.streamId,flags:ee.Flags.NONE,code:Ft.ErrorCodes.CANCELED,message:t}),this.stream.disconnect(this),ct.cancel(this)},r.prototype.close=function(e){var t;if(this.done){console.warn("Trying to close for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));return}this.done=!0,ct.cancel(this),(t=this.cancellable)===null||t===void 0||t.cancel()},r.prototype.onError=function(e){},r.prototype.onComplete=function(){},r}();Ye.RequestFnfResponderStream=kn;var Ke={},qn=C&&C.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t),Object.defineProperty(r,s,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),zn=C&&C.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),jn=C&&C.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&qn(e,r,t);return zn(e,r),e},Ar=C&&C.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],s=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&s>=r.length&&(r=void 0),{value:r&&r[s++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.RequestResponseResponderStream=Ke.RequestResponseRequesterStream=void 0;var Je=be,Tt=de,M=oe,ve=jn(fe),$n=function(){function r(e,t,s,d){this.payload=e,this.receiver=t,this.fragmentSize=s,this.leaseManager=d,this.streamType=M.FrameTypes.REQUEST_RESPONSE}return r.prototype.handleReady=function(e,t){var s,d;if(this.done)return!1;if(this.streamId=e,this.stream=t,t.connect(this),(0,Tt.isFragmentable)(this.payload,this.fragmentSize,M.FrameTypes.REQUEST_RESPONSE))try{for(var a=Ar((0,Tt.fragment)(e,this.payload,this.fragmentSize,M.FrameTypes.REQUEST_RESPONSE)),c=a.next();!c.done;c=a.next()){var u=c.value;this.stream.send(u)}}catch(f){s={error:f}}finally{try{c&&!c.done&&(d=a.return)&&d.call(a)}finally{if(s)throw s.error}}else this.stream.send({type:M.FrameTypes.REQUEST_RESPONSE,data:this.payload.data,metadata:this.payload.metadata,flags:this.payload.metadata?M.Flags.METADATA:0,streamId:e});return this.hasExtension&&this.stream.send({type:M.FrameTypes.EXT,streamId:e,extendedContent:this.extendedContent,extendedType:this.extendedType,flags:this.flags}),!0},r.prototype.handleReject=function(e){this.done||(this.done=!0,this.receiver.onError(e))},r.prototype.handle=function(e){var t,s=e.type;switch(s){case M.FrameTypes.PAYLOAD:{var d=M.Flags.hasComplete(e.flags),a=M.Flags.hasNext(e.flags);if(d||!M.Flags.hasFollows(e.flags)){if(this.done=!0,this.stream.disconnect(this),!a){this.receiver.onComplete();return}var c=this.hasFragments?ve.reassemble(this,e.data,e.metadata):{data:e.data,metadata:e.metadata};this.receiver.onNext(c,!0);return}if(!ve.add(this,e.data,e.metadata)){t="Unexpected fragment size";break}return}case M.FrameTypes.ERROR:{this.done=!0,this.stream.disconnect(this),ve.cancel(this),this.receiver.onError(new Je.RSocketError(e.code,e.message));return}case M.FrameTypes.EXT:{if(this.hasFragments){t="Unexpected frame type [".concat(s,"] during reassembly");break}this.receiver.onExtension(e.extendedType,e.extendedContent,M.Flags.hasIgnore(e.flags));return}default:t="Unexpected frame type [".concat(s,"]")}this.close(new Je.RSocketError(Je.ErrorCodes.CANCELED,t)),this.stream.send({type:M.FrameTypes.CANCEL,streamId:this.streamId,flags:M.Flags.NONE}),this.stream.disconnect(this)},r.prototype.cancel=function(){var e;if(!this.done){if(this.done=!0,!this.streamId){(e=this.leaseManager)===null||e===void 0||e.cancelRequest(this);return}this.stream.send({type:M.FrameTypes.CANCEL,flags:M.Flags.NONE,streamId:this.streamId}),this.stream.disconnect(this),ve.cancel(this)}},r.prototype.onExtension=function(e,t,s){if(!this.done){if(!this.streamId){this.hasExtension=!0,this.extendedType=e,this.extendedContent=t,this.flags=s?M.Flags.IGNORE:M.Flags.NONE;return}this.stream.send({streamId:this.streamId,type:M.FrameTypes.EXT,extendedType:e,extendedContent:t,flags:s?M.Flags.IGNORE:M.Flags.NONE})}},r.prototype.close=function(e){this.done||(this.done=!0,ve.cancel(this),e?this.receiver.onError(e):this.receiver.onComplete())},r}();Ke.RequestResponseRequesterStream=$n;var Hn=function(){function r(e,t,s,d,a){if(this.streamId=e,this.stream=t,this.fragmentSize=s,this.handler=d,this.streamType=M.FrameTypes.REQUEST_RESPONSE,t.connect(this),M.Flags.hasFollows(a.flags)){ve.add(this,a.data,a.metadata);return}var c={data:a.data,metadata:a.metadata};try{this.receiver=d(c,this)}catch(u){this.onError(u)}}return r.prototype.handle=function(e){var t,s;if(!this.receiver||this.hasFragments)if(e.type===M.FrameTypes.PAYLOAD)if(M.Flags.hasFollows(e.flags)){if(ve.add(this,e.data,e.metadata))return;s="Unexpected fragment size"}else{var d=ve.reassemble(this,e.data,e.metadata);try{this.receiver=this.handler(d,this)}catch(a){this.onError(a)}return}else s="Unexpected frame type [".concat(e.type,"] during reassembly");else if(e.type===M.FrameTypes.EXT){this.receiver.onExtension(e.extendedType,e.extendedContent,M.Flags.hasIgnore(e.flags));return}else s="Unexpected frame type [".concat(e.type,"]");this.done=!0,(t=this.receiver)===null||t===void 0||t.cancel(),e.type!==M.FrameTypes.CANCEL&&e.type!==M.FrameTypes.ERROR&&this.stream.send({type:M.FrameTypes.ERROR,flags:M.Flags.NONE,code:Je.ErrorCodes.CANCELED,message:s,streamId:this.streamId}),this.stream.disconnect(this),ve.cancel(this)},r.prototype.onError=function(e){if(this.done){console.warn("Trying to error for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));return}this.done=!0,this.stream.send({type:M.FrameTypes.ERROR,flags:M.Flags.NONE,code:e instanceof Je.RSocketError?e.code:Je.ErrorCodes.APPLICATION_ERROR,message:e.message,streamId:this.streamId}),this.stream.disconnect(this)},r.prototype.onNext=function(e,t){var s,d;if(!this.done){if(this.done=!0,(0,Tt.isFragmentable)(e,this.fragmentSize,M.FrameTypes.PAYLOAD))try{for(var a=Ar((0,Tt.fragment)(this.streamId,e,this.fragmentSize,M.FrameTypes.PAYLOAD,!0)),c=a.next();!c.done;c=a.next()){var u=c.value;this.stream.send(u)}}catch(f){s={error:f}}finally{try{c&&!c.done&&(d=a.return)&&d.call(a)}finally{if(s)throw s.error}}else this.stream.send({type:M.FrameTypes.PAYLOAD,flags:M.Flags.NEXT|M.Flags.COMPLETE|(e.metadata?M.Flags.METADATA:0),data:e.data,metadata:e.metadata,streamId:this.streamId});this.stream.disconnect(this)}},r.prototype.onComplete=function(){this.done||(this.done=!0,this.stream.send({type:M.FrameTypes.PAYLOAD,flags:M.Flags.COMPLETE,streamId:this.streamId,data:null,metadata:null}),this.stream.disconnect(this))},r.prototype.onExtension=function(e,t,s){this.done||this.stream.send({type:M.FrameTypes.EXT,streamId:this.streamId,flags:s?M.Flags.IGNORE:M.Flags.NONE,extendedType:e,extendedContent:t})},r.prototype.close=function(e){var t;if(this.done){console.warn("Trying to close for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));return}ve.cancel(this),(t=this.receiver)===null||t===void 0||t.cancel()},r}();Ke.RequestResponseResponderStream=Hn;var Ze={},Qn=C&&C.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t),Object.defineProperty(r,s,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),Vn=C&&C.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Xn=C&&C.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Qn(e,r,t);return Vn(e,r),e},Ir=C&&C.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],s=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&s>=r.length&&(r=void 0),{value:r&&r[s++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.RequestStreamResponderStream=Ze.RequestStreamRequesterStream=void 0;var et=be,St=de,D=oe,Re=Xn(fe),Gn=function(){function r(e,t,s,d,a){this.payload=e,this.receiver=t,this.fragmentSize=s,this.initialRequestN=d,this.leaseManager=a,this.streamType=D.FrameTypes.REQUEST_STREAM}return r.prototype.handleReady=function(e,t){var s,d;if(this.done)return!1;if(this.streamId=e,this.stream=t,t.connect(this),(0,St.isFragmentable)(this.payload,this.fragmentSize,D.FrameTypes.REQUEST_STREAM))try{for(var a=Ir((0,St.fragmentWithRequestN)(e,this.payload,this.fragmentSize,D.FrameTypes.REQUEST_STREAM,this.initialRequestN)),c=a.next();!c.done;c=a.next()){var u=c.value;this.stream.send(u)}}catch(f){s={error:f}}finally{try{c&&!c.done&&(d=a.return)&&d.call(a)}finally{if(s)throw s.error}}else this.stream.send({type:D.FrameTypes.REQUEST_STREAM,data:this.payload.data,metadata:this.payload.metadata,requestN:this.initialRequestN,flags:this.payload.metadata!==void 0?D.Flags.METADATA:0,streamId:e});return this.hasExtension&&this.stream.send({type:D.FrameTypes.EXT,streamId:e,extendedContent:this.extendedContent,extendedType:this.extendedType,flags:this.flags}),!0},r.prototype.handleReject=function(e){this.done||(this.done=!0,this.receiver.onError(e))},r.prototype.handle=function(e){var t,s=e.type;switch(s){case D.FrameTypes.PAYLOAD:{var d=D.Flags.hasComplete(e.flags),a=D.Flags.hasNext(e.flags);if(d||!D.Flags.hasFollows(e.flags)){if(d&&(this.done=!0,this.stream.disconnect(this),!a)){this.receiver.onComplete();return}var c=this.hasFragments?Re.reassemble(this,e.data,e.metadata):{data:e.data,metadata:e.metadata};this.receiver.onNext(c,d);return}if(!Re.add(this,e.data,e.metadata)){t="Unexpected fragment size";break}return}case D.FrameTypes.ERROR:{this.done=!0,this.stream.disconnect(this),Re.cancel(this),this.receiver.onError(new et.RSocketError(e.code,e.message));return}case D.FrameTypes.EXT:{if(this.hasFragments){t="Unexpected frame type [".concat(s,"] during reassembly");break}this.receiver.onExtension(e.extendedType,e.extendedContent,D.Flags.hasIgnore(e.flags));return}default:t="Unexpected frame type [".concat(s,"]")}this.close(new et.RSocketError(et.ErrorCodes.CANCELED,t)),this.stream.send({type:D.FrameTypes.CANCEL,streamId:this.streamId,flags:D.Flags.NONE}),this.stream.disconnect(this)},r.prototype.request=function(e){if(!this.done){if(!this.streamId){this.initialRequestN+=e;return}this.stream.send({type:D.FrameTypes.REQUEST_N,flags:D.Flags.NONE,requestN:e,streamId:this.streamId})}},r.prototype.cancel=function(){var e;if(!this.done){if(this.done=!0,!this.streamId){(e=this.leaseManager)===null||e===void 0||e.cancelRequest(this);return}this.stream.send({type:D.FrameTypes.CANCEL,flags:D.Flags.NONE,streamId:this.streamId}),this.stream.disconnect(this),Re.cancel(this)}},r.prototype.onExtension=function(e,t,s){if(!this.done){if(!this.streamId){this.hasExtension=!0,this.extendedType=e,this.extendedContent=t,this.flags=s?D.Flags.IGNORE:D.Flags.NONE;return}this.stream.send({streamId:this.streamId,type:D.FrameTypes.EXT,extendedType:e,extendedContent:t,flags:s?D.Flags.IGNORE:D.Flags.NONE})}},r.prototype.close=function(e){this.done||(this.done=!0,Re.cancel(this),e?this.receiver.onError(e):this.receiver.onComplete())},r}();Ze.RequestStreamRequesterStream=Gn;var Wn=function(){function r(e,t,s,d,a){if(this.streamId=e,this.stream=t,this.fragmentSize=s,this.handler=d,this.streamType=D.FrameTypes.REQUEST_STREAM,t.connect(this),D.Flags.hasFollows(a.flags)){this.initialRequestN=a.requestN,Re.add(this,a.data,a.metadata);return}var c={data:a.data,metadata:a.metadata};try{this.receiver=d(c,a.requestN,this)}catch(u){this.onError(u)}}return r.prototype.handle=function(e){var t,s;if(!this.receiver||this.hasFragments)if(e.type===D.FrameTypes.PAYLOAD)if(D.Flags.hasFollows(e.flags)){if(Re.add(this,e.data,e.metadata))return;s="Unexpected frame size"}else{var d=Re.reassemble(this,e.data,e.metadata);try{this.receiver=this.handler(d,this.initialRequestN,this)}catch(a){this.onError(a)}return}else s="Unexpected frame type [".concat(e.type,"] during reassembly");else if(e.type===D.FrameTypes.REQUEST_N){this.receiver.request(e.requestN);return}else if(e.type===D.FrameTypes.EXT){this.receiver.onExtension(e.extendedType,e.extendedContent,D.Flags.hasIgnore(e.flags));return}else s="Unexpected frame type [".concat(e.type,"]");this.done=!0,Re.cancel(this),(t=this.receiver)===null||t===void 0||t.cancel(),e.type!==D.FrameTypes.CANCEL&&e.type!==D.FrameTypes.ERROR&&this.stream.send({type:D.FrameTypes.ERROR,flags:D.Flags.NONE,code:et.ErrorCodes.CANCELED,message:s,streamId:this.streamId}),this.stream.disconnect(this)},r.prototype.onError=function(e){if(this.done){console.warn("Trying to error for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));return}this.done=!0,this.stream.send({type:D.FrameTypes.ERROR,flags:D.Flags.NONE,code:e instanceof et.RSocketError?e.code:et.ErrorCodes.APPLICATION_ERROR,message:e.message,streamId:this.streamId}),this.stream.disconnect(this)},r.prototype.onNext=function(e,t){var s,d;if(!this.done){if(t&&(this.done=!0),(0,St.isFragmentable)(e,this.fragmentSize,D.FrameTypes.PAYLOAD))try{for(var a=Ir((0,St.fragment)(this.streamId,e,this.fragmentSize,D.FrameTypes.PAYLOAD,t)),c=a.next();!c.done;c=a.next()){var u=c.value;this.stream.send(u)}}catch(f){s={error:f}}finally{try{c&&!c.done&&(d=a.return)&&d.call(a)}finally{if(s)throw s.error}}else this.stream.send({type:D.FrameTypes.PAYLOAD,flags:D.Flags.NEXT|(t?D.Flags.COMPLETE:D.Flags.NONE)|(e.metadata?D.Flags.METADATA:D.Flags.NONE),data:e.data,metadata:e.metadata,streamId:this.streamId});t&&this.stream.disconnect(this)}},r.prototype.onComplete=function(){this.done||(this.done=!0,this.stream.send({type:D.FrameTypes.PAYLOAD,flags:D.Flags.COMPLETE,streamId:this.streamId,data:null,metadata:null}),this.stream.disconnect(this))},r.prototype.onExtension=function(e,t,s){this.done||this.stream.send({type:D.FrameTypes.EXT,streamId:this.streamId,flags:s?D.Flags.IGNORE:D.Flags.NONE,extendedType:e,extendedContent:t})},r.prototype.close=function(e){var t;if(this.done){console.warn("Trying to close for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));return}Re.cancel(this),(t=this.receiver)===null||t===void 0||t.cancel()},r}();Ze.RequestStreamResponderStream=Wn,Object.defineProperty(K,"__esModule",{value:!0}),K.KeepAliveSender=K.KeepAliveHandler=K.DefaultConnectionFrameHandler=K.DefaultStreamRequestHandler=K.LeaseHandler=K.RSocketRequester=void 0;var dt=be,Y=oe,xr=Ge,Cr=Ye,Nr=Ke,Or=Ze,Yn=function(){function r(e,t,s){this.connection=e,this.fragmentSize=t,this.leaseManager=s}return r.prototype.fireAndForget=function(e,t){var s=new Cr.RequestFnFRequesterStream(e,t,this.fragmentSize,this.leaseManager);return this.leaseManager?this.leaseManager.requestLease(s):this.connection.multiplexerDemultiplexer.createRequestStream(s),s},r.prototype.requestResponse=function(e,t){var s=new Nr.RequestResponseRequesterStream(e,t,this.fragmentSize,this.leaseManager);return this.leaseManager?this.leaseManager.requestLease(s):this.connection.multiplexerDemultiplexer.createRequestStream(s),s},r.prototype.requestStream=function(e,t,s){var d=new Or.RequestStreamRequesterStream(e,s,this.fragmentSize,t,this.leaseManager);return this.leaseManager?this.leaseManager.requestLease(d):this.connection.multiplexerDemultiplexer.createRequestStream(d),d},r.prototype.requestChannel=function(e,t,s,d){var a=new xr.RequestChannelRequesterStream(e,s,d,this.fragmentSize,t,this.leaseManager);return this.leaseManager?this.leaseManager.requestLease(a):this.connection.multiplexerDemultiplexer.createRequestStream(a),a},r.prototype.metadataPush=function(e,t){throw new Error("Method not implemented.")},r.prototype.close=function(e){this.connection.close(e)},r.prototype.onClose=function(e){this.connection.onClose(e)},r}();K.RSocketRequester=Yn;var Kn=function(){function r(e,t){this.maxPendingRequests=e,this.multiplexer=t,this.pendingRequests=[],this.expirationTime=0,this.availableLease=0}return r.prototype.handle=function(e){for(this.expirationTime=e.ttl+Date.now(),this.availableLease=e.requestCount;this.availableLease>0&&this.pendingRequests.length>0;){var t=this.pendingRequests.shift();this.availableLease--,this.multiplexer.createRequestStream(t)}},r.prototype.requestLease=function(e){var t=this.availableLease;if(t>0&&Date.now()<this.expirationTime){this.availableLease=t-1,this.multiplexer.createRequestStream(e);return}if(this.pendingRequests.length>=this.maxPendingRequests){e.handleReject(new dt.RSocketError(dt.ErrorCodes.REJECTED,"No available lease given"));return}this.pendingRequests.push(e)},r.prototype.cancelRequest=function(e){var t=this.pendingRequests.indexOf(e);t>-1&&this.pendingRequests.splice(t,1)},r}();K.LeaseHandler=Kn;var Jn=function(){function r(e,t){this.rsocket=e,this.fragmentSize=t}return r.prototype.handle=function(e,t){switch(e.type){case Y.FrameTypes.REQUEST_FNF:this.rsocket.fireAndForget&&new Cr.RequestFnfResponderStream(e.streamId,t,this.rsocket.fireAndForget.bind(this.rsocket),e);return;case Y.FrameTypes.REQUEST_RESPONSE:if(this.rsocket.requestResponse){new Nr.RequestResponseResponderStream(e.streamId,t,this.fragmentSize,this.rsocket.requestResponse.bind(this.rsocket),e);return}this.rejectRequest(e.streamId,t);return;case Y.FrameTypes.REQUEST_STREAM:if(this.rsocket.requestStream){new Or.RequestStreamResponderStream(e.streamId,t,this.fragmentSize,this.rsocket.requestStream.bind(this.rsocket),e);return}this.rejectRequest(e.streamId,t);return;case Y.FrameTypes.REQUEST_CHANNEL:if(this.rsocket.requestChannel){new xr.RequestChannelResponderStream(e.streamId,t,this.fragmentSize,this.rsocket.requestChannel.bind(this.rsocket),e);return}this.rejectRequest(e.streamId,t);return}},r.prototype.rejectRequest=function(e,t){t.send({type:Y.FrameTypes.ERROR,streamId:e,flags:Y.Flags.NONE,code:dt.ErrorCodes.REJECTED,message:"No available handler found"})},r.prototype.close=function(){},r}();K.DefaultStreamRequestHandler=Jn;var Zn=function(){function r(e,t,s,d,a){this.connection=e,this.keepAliveHandler=t,this.keepAliveSender=s,this.leaseHandler=d,this.rsocket=a}return r.prototype.handle=function(e){switch(e.type){case Y.FrameTypes.KEEPALIVE:this.keepAliveHandler.handle(e);return;case Y.FrameTypes.LEASE:if(this.leaseHandler){this.leaseHandler.handle(e);return}return;case Y.FrameTypes.ERROR:this.connection.close(new dt.RSocketError(e.code,e.message));return;case Y.FrameTypes.METADATA_PUSH:this.rsocket.metadataPush;return;default:this.connection.multiplexerDemultiplexer.connectionOutbound.send({type:Y.FrameTypes.ERROR,streamId:0,flags:Y.Flags.NONE,message:"Received unknown frame type",code:dt.ErrorCodes.CONNECTION_ERROR})}},r.prototype.pause=function(){var e;this.keepAliveHandler.pause(),(e=this.keepAliveSender)===null||e===void 0||e.pause()},r.prototype.resume=function(){var e;this.keepAliveHandler.start(),(e=this.keepAliveSender)===null||e===void 0||e.start()},r.prototype.close=function(e){var t;this.keepAliveHandler.close(),(t=this.rsocket.close)===null||t===void 0||t.call(this.rsocket,e)},r}();K.DefaultConnectionFrameHandler=Zn;var Ne;(function(r){r[r.Paused=0]="Paused",r[r.Running=1]="Running",r[r.Closed=2]="Closed"})(Ne||(Ne={}));var ei=function(){function r(e,t){this.connection=e,this.keepAliveTimeoutDuration=t,this.state=Ne.Paused,this.outbound=e.multiplexerDemultiplexer.connectionOutbound}return r.prototype.handle=function(e){this.keepAliveLastReceivedMillis=Date.now(),Y.Flags.hasRespond(e.flags)&&this.outbound.send({type:Y.FrameTypes.KEEPALIVE,streamId:0,data:e.data,flags:e.flags^Y.Flags.RESPOND,lastReceivedPosition:0})},r.prototype.start=function(){this.state===Ne.Paused&&(this.keepAliveLastReceivedMillis=Date.now(),this.state=Ne.Running,this.activeTimeout=setTimeout(this.timeoutCheck.bind(this),this.keepAliveTimeoutDuration))},r.prototype.pause=function(){this.state===Ne.Running&&(this.state=Ne.Paused,clearTimeout(this.activeTimeout))},r.prototype.close=function(){this.state=Ne.Closed,clearTimeout(this.activeTimeout)},r.prototype.timeoutCheck=function(){var e=Date.now(),t=e-this.keepAliveLastReceivedMillis;t>=this.keepAliveTimeoutDuration?this.connection.close(new Error("No keep-alive acks for ".concat(this.keepAliveTimeoutDuration," millis"))):this.activeTimeout=setTimeout(this.timeoutCheck.bind(this),Math.max(100,this.keepAliveTimeoutDuration-t))},r}();K.KeepAliveHandler=ei;var Oe;(function(r){r[r.Paused=0]="Paused",r[r.Running=1]="Running",r[r.Closed=2]="Closed"})(Oe||(Oe={}));var ti=function(){function r(e,t){this.outbound=e,this.keepAlivePeriodDuration=t,this.state=Oe.Paused}return r.prototype.sendKeepAlive=function(){this.outbound.send({type:Y.FrameTypes.KEEPALIVE,streamId:0,data:void 0,flags:Y.Flags.RESPOND,lastReceivedPosition:0})},r.prototype.start=function(){this.state===Oe.Paused&&(this.state=Oe.Running,this.activeInterval=setInterval(this.sendKeepAlive.bind(this),this.keepAlivePeriodDuration))},r.prototype.pause=function(){this.state===Oe.Running&&(this.state=Oe.Paused,clearInterval(this.activeInterval))},r.prototype.close=function(){this.state=Oe.Closed,clearInterval(this.activeInterval)},r}();K.KeepAliveSender=ti;var ft={},Ur;function Dr(){if(Ur)return ft;Ur=1;var r=C&&C.__values||function(d){var a=typeof Symbol=="function"&&Symbol.iterator,c=a&&d[a],u=0;if(c)return c.call(d);if(d&&typeof d.length=="number")return{next:function(){return d&&u>=d.length&&(d=void 0),{value:d&&d[u++],done:!d}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(ft,"__esModule",{value:!0}),ft.FrameStore=void 0;var e=Wt(),t=Vt,s=function(){function d(){this.storedFrames=[],this._lastReceivedFramePosition=0,this._firstAvailableFramePosition=0,this._lastSentFramePosition=0}return Object.defineProperty(d.prototype,"lastReceivedFramePosition",{get:function(){return this._lastReceivedFramePosition},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"firstAvailableFramePosition",{get:function(){return this._firstAvailableFramePosition},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"lastSentFramePosition",{get:function(){return this._lastSentFramePosition},enumerable:!1,configurable:!0}),d.prototype.store=function(a){this._lastSentFramePosition+=(0,t.sizeOfFrame)(a),this.storedFrames.push(a)},d.prototype.record=function(a){this._lastReceivedFramePosition+=(0,t.sizeOfFrame)(a)},d.prototype.dropTo=function(a){for(var c=a-this._firstAvailableFramePosition;c>0&&this.storedFrames.length>0;){var u=this.storedFrames.shift();c-=(0,t.sizeOfFrame)(u)}if(c!==0)throw new e.RSocketError(e.ErrorCodes.CONNECTION_ERROR,"State inconsistency. Expected bytes to drop ".concat(a-this._firstAvailableFramePosition," but actual ").concat(c));this._firstAvailableFramePosition=a},d.prototype.drain=function(a){var c,u;try{for(var f=r(this.storedFrames),g=f.next();!g.done;g=f.next()){var _=g.value;a(_)}}catch(m){c={error:m}}finally{try{g&&!g.done&&(u=f.return)&&u.call(f)}finally{if(c)throw c.error}}},d}();return ft.FrameStore=s,ft}var Lr;function ri(){if(Lr)return lt;Lr=1;var r=C&&C.__awaiter||function(u,f,g,_){function m(E){return E instanceof g?E:new g(function(y){y(E)})}return new(g||(g=Promise))(function(E,y){function T(b){try{F(_.next(b))}catch(U){y(U)}}function S(b){try{F(_.throw(b))}catch(U){y(U)}}function F(b){b.done?E(b.value):m(b.value).then(T,S)}F((_=_.apply(u,f||[])).next())})},e=C&&C.__generator||function(u,f){var g={label:0,sent:function(){if(E[0]&1)throw E[1];return E[1]},trys:[],ops:[]},_,m,E,y;return y={next:T(0),throw:T(1),return:T(2)},typeof Symbol=="function"&&(y[Symbol.iterator]=function(){return this}),y;function T(F){return function(b){return S([F,b])}}function S(F){if(_)throw new TypeError("Generator is already executing.");for(;g;)try{if(_=1,m&&(E=F[0]&2?m.return:F[0]?m.throw||((E=m.return)&&E.call(m),0):m.next)&&!(E=E.call(m,F[1])).done)return E;switch(m=0,E&&(F=[F[0]&2,E.value]),F[0]){case 0:case 1:E=F;break;case 4:return g.label++,{value:F[1],done:!1};case 5:g.label++,m=F[1],F=[0];continue;case 7:F=g.ops.pop(),g.trys.pop();continue;default:if(E=g.trys,!(E=E.length>0&&E[E.length-1])&&(F[0]===6||F[0]===2)){g=0;continue}if(F[0]===3&&(!E||F[1]>E[0]&&F[1]<E[3])){g.label=F[1];break}if(F[0]===6&&g.label<E[1]){g.label=E[1],E=F;break}if(E&&g.label<E[2]){g.label=E[2],g.ops.push(F);break}E[2]&&g.ops.pop(),g.trys.pop();continue}F=f.call(u,g)}catch(b){F=[6,b],m=0}finally{_=E=0}if(F[0]&5)throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}};Object.defineProperty(lt,"__esModule",{value:!0}),lt.RSocketConnector=void 0;var t=Tr(),s=oe,d=K,a=Dr(),c=function(){function u(f){this.config=f}return u.prototype.connect=function(){var f,g,_,m,E,y,T,S,F,b,U,q,O,z,H,te,re,ne,he,ie;return r(this,void 0,void 0,function(){var $,se,J,Ie,Ue,Pe,ke,qe,rt,Q=this;return e(this,function(G){switch(G.label){case 0:return $=this.config,se={type:s.FrameTypes.SETUP,dataMimeType:(g=(f=$.setup)===null||f===void 0?void 0:f.dataMimeType)!==null&&g!==void 0?g:"application/octet-stream",metadataMimeType:(m=(_=$.setup)===null||_===void 0?void 0:_.metadataMimeType)!==null&&m!==void 0?m:"application/octet-stream",keepAlive:(y=(E=$.setup)===null||E===void 0?void 0:E.keepAlive)!==null&&y!==void 0?y:6e4,lifetime:(S=(T=$.setup)===null||T===void 0?void 0:T.lifetime)!==null&&S!==void 0?S:3e5,metadata:(b=(F=$.setup)===null||F===void 0?void 0:F.payload)===null||b===void 0?void 0:b.metadata,data:(q=(U=$.setup)===null||U===void 0?void 0:U.payload)===null||q===void 0?void 0:q.data,resumeToken:(z=(O=$.resume)===null||O===void 0?void 0:O.tokenGenerator())!==null&&z!==void 0?z:null,streamId:0,majorVersion:1,minorVersion:0,flags:(!((te=(H=$.setup)===null||H===void 0?void 0:H.payload)===null||te===void 0)&&te.metadata?s.Flags.METADATA:s.Flags.NONE)|($.lease?s.Flags.LEASE:s.Flags.NONE)|($.resume?s.Flags.RESUME_ENABLE:s.Flags.NONE)},[4,$.transport.connect(function(pe){return $.resume?new t.ResumableClientServerInputMultiplexerDemultiplexer(t.StreamIdGenerator.create(-1),pe,pe,new a.FrameStore,se.resumeToken.toString(),function(ze,je){return r(Q,void 0,void 0,function(){var $e,De,ue;return e(this,function(xe){switch(xe.label){case 0:return $e=function(Le){return Le.send({type:s.FrameTypes.RESUME,streamId:0,flags:s.Flags.NONE,clientPosition:je.firstAvailableFramePosition,serverPosition:je.lastReceivedFramePosition,majorVersion:se.minorVersion,minorVersion:se.majorVersion,resumeToken:se.resumeToken}),new t.ResumeOkAwaitingResumableClientServerInputMultiplexerDemultiplexer(Le,Le,ze)},De=-1,ue=function(){return De++,$.resume.reconnectFunction(De).then(function(){return $.transport.connect($e).catch(ue)})},[4,ue()];case 1:return xe.sent(),[2]}})})}):new t.ClientServerInputMultiplexerDemultiplexer(t.StreamIdGenerator.create(-1),pe,pe)})];case 1:return J=G.sent(),Ie=new d.KeepAliveSender(J.multiplexerDemultiplexer.connectionOutbound,se.keepAlive),Ue=new d.KeepAliveHandler(J,se.lifetime),Pe=$.lease?new d.LeaseHandler((re=$.lease.maxPendingRequests)!==null&&re!==void 0?re:256,J.multiplexerDemultiplexer):void 0,ke=(ne=$.responder)!==null&&ne!==void 0?ne:{},qe=new d.DefaultConnectionFrameHandler(J,Ue,Ie,Pe,ke),rt=new d.DefaultStreamRequestHandler(ke,0),J.onClose(function(pe){Ie.close(),Ue.close(),qe.close(pe)}),J.multiplexerDemultiplexer.connectionInbound(qe),J.multiplexerDemultiplexer.handleRequestStream(rt),J.multiplexerDemultiplexer.connectionOutbound.send(se),Ue.start(),Ie.start(),[2,new d.RSocketRequester(J,(ie=(he=$.fragmentation)===null||he===void 0?void 0:he.maxOutboundFragmentSize)!==null&&ie!==void 0?ie:0,Pe)]}})})},u}();return lt.RSocketConnector=c,lt}var ht={},Mr;function ni(){if(Mr)return ht;Mr=1;var r=C&&C.__awaiter||function(f,g,_,m){function E(y){return y instanceof _?y:new _(function(T){T(y)})}return new(_||(_=Promise))(function(y,T){function S(U){try{b(m.next(U))}catch(q){T(q)}}function F(U){try{b(m.throw(U))}catch(q){T(q)}}function b(U){U.done?y(U.value):E(U.value).then(S,F)}b((m=m.apply(f,g||[])).next())})},e=C&&C.__generator||function(f,g){var _={label:0,sent:function(){if(y[0]&1)throw y[1];return y[1]},trys:[],ops:[]},m,E,y,T;return T={next:S(0),throw:S(1),return:S(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function S(b){return function(U){return F([b,U])}}function F(b){if(m)throw new TypeError("Generator is already executing.");for(;_;)try{if(m=1,E&&(y=b[0]&2?E.return:b[0]?E.throw||((y=E.return)&&y.call(E),0):E.next)&&!(y=y.call(E,b[1])).done)return y;switch(E=0,y&&(b=[b[0]&2,y.value]),b[0]){case 0:case 1:y=b;break;case 4:return _.label++,{value:b[1],done:!1};case 5:_.label++,E=b[1],b=[0];continue;case 7:b=_.ops.pop(),_.trys.pop();continue;default:if(y=_.trys,!(y=y.length>0&&y[y.length-1])&&(b[0]===6||b[0]===2)){_=0;continue}if(b[0]===3&&(!y||b[1]>y[0]&&b[1]<y[3])){_.label=b[1];break}if(b[0]===6&&_.label<y[1]){_.label=y[1],y=b;break}if(y&&_.label<y[2]){_.label=y[2],_.ops.push(b);break}y[2]&&_.ops.pop(),_.trys.pop();continue}b=g.call(f,_)}catch(U){b=[6,U],E=0}finally{m=y=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}};Object.defineProperty(ht,"__esModule",{value:!0}),ht.RSocketServer=void 0;var t=Tr(),s=be,d=oe,a=K,c=Dr(),u=function(){function f(g){var _,m;this.acceptor=g.acceptor,this.transport=g.transport,this.lease=g.lease,this.serverSideKeepAlive=g.serverSideKeepAlive,this.sessionStore=g.resume?{}:void 0,this.sessionTimeout=(m=(_=g.resume)===null||_===void 0?void 0:_.sessionTimeout)!==null&&m!==void 0?m:void 0}return f.prototype.bind=function(){return r(this,void 0,void 0,function(){var g=this;return e(this,function(_){switch(_.label){case 0:return[4,this.transport.bind(function(m,E){return r(g,void 0,void 0,function(){var y,T,T,S,F,b,U,q,O,z,H,te,re,ne,he;return e(this,function(ie){switch(ie.label){case 0:switch(y=m.type,y){case d.FrameTypes.SETUP:return[3,1];case d.FrameTypes.RESUME:return[3,5]}return[3,6];case 1:return ie.trys.push([1,3,,4]),this.lease&&!d.Flags.hasLease(m.flags)?(T=new s.RSocketError(s.ErrorCodes.REJECTED_SETUP,"Lease has to be enabled"),E.multiplexerDemultiplexer.connectionOutbound.send({type:d.FrameTypes.ERROR,streamId:0,flags:d.Flags.NONE,code:T.code,message:T.message}),E.close(T),[2]):d.Flags.hasLease(m.flags)&&!this.lease?(T=new s.RSocketError(s.ErrorCodes.REJECTED_SETUP,"Lease has to be disabled"),E.multiplexerDemultiplexer.connectionOutbound.send({type:d.FrameTypes.ERROR,streamId:0,flags:d.Flags.NONE,code:T.code,message:T.message}),E.close(T),[2]):(S=d.Flags.hasLease(m.flags)?new a.LeaseHandler((te=this.lease.maxPendingRequests)!==null&&te!==void 0?te:256,E.multiplexerDemultiplexer):void 0,F=new a.RSocketRequester(E,(ne=(re=this.fragmentation)===null||re===void 0?void 0:re.maxOutboundFragmentSize)!==null&&ne!==void 0?ne:0,S),[4,this.acceptor.accept({data:m.data,dataMimeType:m.dataMimeType,metadata:m.metadata,metadataMimeType:m.metadataMimeType,flags:m.flags,keepAliveMaxLifetime:m.lifetime,keepAliveInterval:m.keepAlive,resumeToken:m.resumeToken},F)]);case 2:return b=ie.sent(),U=new a.KeepAliveHandler(E,m.lifetime),q=this.serverSideKeepAlive?new a.KeepAliveSender(E.multiplexerDemultiplexer.connectionOutbound,m.keepAlive):void 0,O=new a.DefaultConnectionFrameHandler(E,U,q,S,b),z=new a.DefaultStreamRequestHandler(b,0),E.onClose(function($){q==null||q.close(),U.close(),O.close($)}),E.multiplexerDemultiplexer.connectionInbound(O),E.multiplexerDemultiplexer.handleRequestStream(z),U.start(),q==null||q.start(),[3,4];case 3:return H=ie.sent(),E.multiplexerDemultiplexer.connectionOutbound.send({type:d.FrameTypes.ERROR,streamId:0,code:s.ErrorCodes.REJECTED_SETUP,message:(he=H.message)!==null&&he!==void 0?he:"",flags:d.Flags.NONE}),E.close(H instanceof s.RSocketError?H:new s.RSocketError(s.ErrorCodes.REJECTED_SETUP,H.message)),[3,4];case 4:return[2];case 5:return[2];case 6:E.multiplexerDemultiplexer.connectionOutbound.send({type:d.FrameTypes.ERROR,streamId:0,code:s.ErrorCodes.UNSUPPORTED_SETUP,message:"Unsupported setup",flags:d.Flags.NONE}),E.close(new s.RSocketError(s.ErrorCodes.UNSUPPORTED_SETUP)),ie.label=7;case 7:return[2]}})})},function(m,E){if(m.type===d.FrameTypes.RESUME){if(g.sessionStore){var y=g.sessionStore[m.resumeToken.toString()];if(!y){E.send({type:d.FrameTypes.ERROR,streamId:0,code:s.ErrorCodes.REJECTED_RESUME,message:"No session found for the given resume token",flags:d.Flags.NONE}),E.close();return}return y.resume(m,E,E),y}E.send({type:d.FrameTypes.ERROR,streamId:0,code:s.ErrorCodes.REJECTED_RESUME,message:"Resume is not enabled",flags:d.Flags.NONE}),E.close();return}else if(m.type===d.FrameTypes.SETUP&&d.Flags.hasResume(m.flags)){if(!g.sessionStore){var T=new s.RSocketError(s.ErrorCodes.REJECTED_SETUP,"No resume support");E.send({type:d.FrameTypes.ERROR,streamId:0,flags:d.Flags.NONE,code:T.code,message:T.message}),E.close(T);return}var S=new t.ResumableClientServerInputMultiplexerDemultiplexer(t.StreamIdGenerator.create(0),E,E,new c.FrameStore,m.resumeToken.toString(),g.sessionStore,g.sessionTimeout);return g.sessionStore[m.resumeToken.toString()]=S,S}return new t.ClientServerInputMultiplexerDemultiplexer(t.StreamIdGenerator.create(0),E,E)})];case 1:return[2,_.sent()]}})})},f}();return ht.RSocketServer=u,ht}var Br={};Object.defineProperty(Br,"__esModule",{value:!0});var Pr;function Wt(){return Pr||(Pr=1,function(r){var e=C&&C.__createBinding||(Object.create?function(s,d,a,c){c===void 0&&(c=a),Object.defineProperty(s,c,{enumerable:!0,get:function(){return d[a]}})}:function(s,d,a,c){c===void 0&&(c=a),s[c]=d[a]}),t=C&&C.__exportStar||function(s,d){for(var a in s)a!=="default"&&!Object.prototype.hasOwnProperty.call(d,a)&&e(d,s,a)};Object.defineProperty(r,"__esModule",{value:!0}),t(Vt,r),t(vr,r),t(ut,r),t(be,r),t(oe,r),t(wr,r),t(ri(),r),t(ni(),r),t(Br,r)}(Qt)),Qt}Wt(),ot("wasmrs:connection:wasm"),ot("wasmrs:connection:worker");var kr;(function(r){r.SnapshotPreview1="preview1"})(kr||(kr={}));const ii=0,si=1,Ae=0,P=8,ai=20,bt=28,oi=31,qr=44,Yt=63,At=2,It=64;class pt{static read_bytes(e,t){const s=new pt;return s.buf=e.getUint32(t,!0),s.buf_len=e.getUint32(t+4,!0),s}static read_bytes_array(e,t,s){const d=[];for(let a=0;a<s;a++)d.push(pt.read_bytes(e,t+8*a));return d}}class mt{static read_bytes(e,t){const s=new mt;return s.buf=e.getUint32(t,!0),s.buf_len=e.getUint32(t+4,!0),s}static read_bytes_array(e,t,s){const d=[];for(let a=0;a<s;a++)d.push(mt.read_bytes(e,t+8*a));return d}}const zr=0,jr=1,xt=2,Kt=3,yt=4;class ui{head_length(){return 24}name_length(){return this.dir_name.byteLength}write_head_bytes(e,t){e.setBigUint64(t,this.d_next,!0),e.setBigUint64(t+8,this.d_ino,!0),e.setUint32(t+16,this.dir_name.length,!0),e.setUint8(t+20,this.d_type)}write_name_bytes(e,t,s){e.set(this.dir_name.slice(0,Math.min(this.dir_name.byteLength,s)),t)}constructor(e,t,s){this.d_ino=1n;const d=new TextEncoder().encode(t);this.d_next=e,this.d_namlen=d.byteLength,this.d_type=s,this.dir_name=d}}const $r=1;class Jt{write_bytes(e,t){e.setUint8(t,this.fs_filetype),e.setUint16(t+2,this.fs_flags,!0),e.setBigUint64(t+8,this.fs_rights_base,!0),e.setBigUint64(t+16,this.fs_rights_inherited,!0)}constructor(e,t,s=0n){this.fs_rights_base=0n,this.fs_rights_inherited=0n,this.fs_filetype=e,this.fs_flags=t,this.fs_rights_base=s}}const Zt=1,Et=2,Hr=4,Qr=8;class Ct{write_bytes(e,t){e.setBigUint64(t,this.dev,!0),e.setBigUint64(t+8,this.ino,!0),e.setUint8(t+16,this.filetype),e.setBigUint64(t+24,this.nlink,!0),e.setBigUint64(t+32,this.size,!0),e.setBigUint64(t+38,this.atim,!0),e.setBigUint64(t+46,this.mtim,!0),e.setBigUint64(t+52,this.ctim,!0)}constructor(e,t){this.dev=0n,this.ino=0n,this.nlink=0n,this.atim=0n,this.mtim=0n,this.ctim=0n,this.filetype=e,this.size=t}}const li=0;class ci{write_bytes(e,t){e.setUint32(t,this.pr_name_len,!0)}constructor(e){this.pr_name_len=e}}class er{static dir(e){const t=new er;return t.tag=li,t.inner=new ci(e),t}write_bytes(e,t){e.setUint32(t,this.tag,!0),this.inner.write_bytes(e,t+4)}}let di=class{enable(e){this.log=fi(e===void 0?!0:e,this.prefix)}get enabled(){return this.isEnabled}constructor(e){this.isEnabled=e,this.prefix="wasi:",this.enable(e)}};function fi(r,e){return r?console.log.bind(console,"%c%s","color: #265BA0",e):()=>{}}const X=new di(!1);let hi=class{start(e){this.inst=e,X.log("calling _start"),e.exports._start()}initialize(e){this.inst=e,e.exports._initialize?(X.log("calling _initialize"),e.exports._initialize()):X.log("no _initialize found")}constructor(e=[],t=[],s=[],d={}){this.args=[],this.env=[],this.fds=[],X.enable(d.debug),X.log("initializing wasi",{args:e,env:t,fds:s}),this.args=e,this.env=t,this.fds=s;const a=this;this.wasiImport={args_sizes_get(c,u){const f=new DataView(a.inst.exports.memory.buffer);f.setUint32(c,a.args.length,!0);let g=0;for(const _ of a.args)g+=_.length+1;return f.setUint32(u,g,!0),X.log(f.getUint32(c,!0),f.getUint32(u,!0)),0},args_get(c,u){const f=new DataView(a.inst.exports.memory.buffer),g=new Uint8Array(a.inst.exports.memory.buffer),_=u;for(let m=0;m<a.args.length;m++){f.setUint32(c,u,!0),c+=4;const E=new TextEncoder().encode(a.args[m]);g.set(E,u),f.setUint8(u+E.length,0),u+=E.length+1}return X.enabled&&X.log(new TextDecoder("utf-8").decode(g.slice(_,u))),0},environ_sizes_get(c,u){const f=new DataView(a.inst.exports.memory.buffer);f.setUint32(c,a.env.length,!0);let g=0;for(const _ of a.env)g+=_.length+1;return f.setUint32(u,g,!0),X.log(f.getUint32(c,!0),f.getUint32(u,!0)),0},environ_get(c,u){const f=new DataView(a.inst.exports.memory.buffer),g=new Uint8Array(a.inst.exports.memory.buffer),_=u;for(let m=0;m<a.env.length;m++){f.setUint32(c,u,!0),c+=4;const E=new TextEncoder().encode(a.env[m]);g.set(E,u),f.setUint8(u+E.length,0),u+=E.length+1}return X.enabled&&X.log(new TextDecoder("utf-8").decode(g.slice(_,u))),0},clock_res_get(c,u){throw"unimplemented"},clock_time_get(c,u,f){const g=new DataView(a.inst.exports.memory.buffer);if(c===ii)g.setBigUint64(f,BigInt(new Date().getTime())*1000000n,!0);else if(c==si){let _;try{_=BigInt(Math.round(performance.now()*1e6))}catch{_=0n}g.setBigUint64(f,_,!0)}else g.setBigUint64(f,0n,!0);return 0},fd_advise(c,u,f,g){return a.fds[c]!=null?a.fds[c].fd_advise(u,f,g):P},fd_allocate(c,u,f){return a.fds[c]!=null?a.fds[c].fd_allocate(u,f):P},fd_close(c){if(a.fds[c]!=null){const u=a.fds[c].fd_close();return a.fds[c]=void 0,u}else return P},fd_datasync(c){return a.fds[c]!=null?a.fds[c].fd_datasync():P},fd_fdstat_get(c,u){if(a.fds[c]!=null){const{ret:f,fdstat:g}=a.fds[c].fd_fdstat_get();return g!=null&&g.write_bytes(new DataView(a.inst.exports.memory.buffer),u),f}else return P},fd_fdstat_set_flags(c,u){return a.fds[c]!=null?a.fds[c].fd_fdstat_set_flags(u):P},fd_fdstat_set_rights(c,u,f){return a.fds[c]!=null?a.fds[c].fd_fdstat_set_rights(u,f):P},fd_filestat_get(c,u){if(a.fds[c]!=null){const{ret:f,filestat:g}=a.fds[c].fd_filestat_get();return g!=null&&g.write_bytes(new DataView(a.inst.exports.memory.buffer),u),f}else return P},fd_filestat_set_size(c,u){return a.fds[c]!=null?a.fds[c].fd_filestat_set_size(u):P},fd_filestat_set_times(c,u,f,g){return a.fds[c]!=null?a.fds[c].fd_filestat_set_times(u,f,g):P},fd_pread(c,u,f,g,_){const m=new DataView(a.inst.exports.memory.buffer),E=new Uint8Array(a.inst.exports.memory.buffer);if(a.fds[c]!=null){const y=pt.read_bytes_array(m,u,f),{ret:T,nread:S}=a.fds[c].fd_pread(E,y,g);return m.setUint32(_,S,!0),T}else return P},fd_prestat_get(c,u){const f=new DataView(a.inst.exports.memory.buffer);if(a.fds[c]!=null){const{ret:g,prestat:_}=a.fds[c].fd_prestat_get();return _!=null&&_.write_bytes(f,u),g}else return P},fd_prestat_dir_name(c,u,f){if(a.fds[c]!=null){const{ret:g,prestat_dir_name:_}=a.fds[c].fd_prestat_dir_name();return _!=null&&new Uint8Array(a.inst.exports.memory.buffer).set(_,u),g}else return P},fd_pwrite(c,u,f,g,_){const m=new DataView(a.inst.exports.memory.buffer),E=new Uint8Array(a.inst.exports.memory.buffer);if(a.fds[c]!=null){const y=mt.read_bytes_array(m,u,f),{ret:T,nwritten:S}=a.fds[c].fd_pwrite(E,y,g);return m.setUint32(_,S,!0),T}else return P},fd_read(c,u,f,g){const _=new DataView(a.inst.exports.memory.buffer),m=new Uint8Array(a.inst.exports.memory.buffer);if(a.fds[c]!=null){const E=pt.read_bytes_array(_,u,f),{ret:y,nread:T}=a.fds[c].fd_read(m,E);return _.setUint32(g,T,!0),y}else return P},fd_readdir(c,u,f,g,_){const m=new DataView(a.inst.exports.memory.buffer),E=new Uint8Array(a.inst.exports.memory.buffer);if(a.fds[c]!=null){let y=0;for(;;){const{ret:T,dirent:S}=a.fds[c].fd_readdir_single(g);if(T!=0)return m.setUint32(_,y,!0),T;if(S==null)break;if(f-y<S.head_length()){y=f;break}const F=new ArrayBuffer(S.head_length());if(S.write_head_bytes(new DataView(F),0),E.set(new Uint8Array(F).slice(0,Math.min(F.byteLength,f-y)),u),u+=S.head_length(),y+=S.head_length(),f-y<S.name_length()){y=f;break}S.write_name_bytes(E,u,f-y),u+=S.name_length(),y+=S.name_length(),g=S.d_next}return m.setUint32(_,y,!0),0}else return P},fd_renumber(c,u){if(a.fds[c]!=null&&a.fds[u]!=null){const f=a.fds[u].fd_close();return f!=0?f:(a.fds[u]=a.fds[c],a.fds[c]=void 0,0)}else return P},fd_seek(c,u,f,g){const _=new DataView(a.inst.exports.memory.buffer);if(a.fds[c]!=null){const{ret:m,offset:E}=a.fds[c].fd_seek(u,f);return _.setBigInt64(g,E,!0),m}else return P},fd_sync(c){return a.fds[c]!=null?a.fds[c].fd_sync():P},fd_tell(c,u){const f=new DataView(a.inst.exports.memory.buffer);if(a.fds[c]!=null){const{ret:g,offset:_}=a.fds[c].fd_tell();return f.setBigUint64(u,_,!0),g}else return P},fd_write(c,u,f,g){const _=new DataView(a.inst.exports.memory.buffer),m=new Uint8Array(a.inst.exports.memory.buffer);if(a.fds[c]!=null){const E=mt.read_bytes_array(_,u,f),{ret:y,nwritten:T}=a.fds[c].fd_write(m,E);return _.setUint32(g,T,!0),y}else return P},path_create_directory(c,u,f){const g=new Uint8Array(a.inst.exports.memory.buffer);if(a.fds[c]!=null){const _=new TextDecoder("utf-8").decode(g.slice(u,u+f));return a.fds[c].path_create_directory(_)}else return P},path_filestat_get(c,u,f,g,_){const m=new DataView(a.inst.exports.memory.buffer),E=new Uint8Array(a.inst.exports.memory.buffer);if(a.fds[c]!=null){const y=new TextDecoder("utf-8").decode(E.slice(f,f+g)),{ret:T,filestat:S}=a.fds[c].path_filestat_get(u,y);return S!=null&&S.write_bytes(m,_),T}else return P},path_filestat_set_times(c,u,f,g,_,m,E){const y=new Uint8Array(a.inst.exports.memory.buffer);if(a.fds[c]!=null){const T=new TextDecoder("utf-8").decode(y.slice(f,f+g));return a.fds[c].path_filestat_set_times(u,T,_,m,E)}else return P},path_link(c,u,f,g,_,m,E){const y=new Uint8Array(a.inst.exports.memory.buffer);if(a.fds[c]!=null&&a.fds[_]!=null){const T=new TextDecoder("utf-8").decode(y.slice(f,f+g)),S=new TextDecoder("utf-8").decode(y.slice(m,m+E));return a.fds[_].path_link(c,u,T,S)}else return P},path_open(c,u,f,g,_,m,E,y,T){const S=new DataView(a.inst.exports.memory.buffer),F=new Uint8Array(a.inst.exports.memory.buffer);if(a.fds[c]!=null){const b=new TextDecoder("utf-8").decode(F.slice(f,f+g));X.log({path:b});const{ret:U,fd_obj:q}=a.fds[c].path_open(u,b,_,m,E,y);if(U!=0)return U;a.fds.push(q);const O=a.fds.length-1;return S.setUint32(T,O,!0),0}else return P},path_readlink(c,u,f,g,_,m){const E=new DataView(a.inst.exports.memory.buffer),y=new Uint8Array(a.inst.exports.memory.buffer);if(a.fds[c]!=null){const T=new TextDecoder("utf-8").decode(y.slice(u,u+f));X.log({path:T});const{ret:S,data:F}=a.fds[c].path_readlink(T);if(F!=null){if(F.length>_)return E.setUint32(m,0,!0),P;y.set(F,g),E.setUint32(m,F.length,!0)}return S}else return P},path_remove_directory(c,u,f){const g=new Uint8Array(a.inst.exports.memory.buffer);if(a.fds[c]!=null){const _=new TextDecoder("utf-8").decode(g.slice(u,u+f));return a.fds[c].path_remove_directory(_)}else return P},path_rename(c,u,f,g,_,m){throw"FIXME what is the best abstraction for this?"},path_symlink(c,u,f,g,_){const m=new Uint8Array(a.inst.exports.memory.buffer);if(a.fds[f]!=null){const E=new TextDecoder("utf-8").decode(m.slice(c,c+u)),y=new TextDecoder("utf-8").decode(m.slice(g,g+_));return a.fds[f].path_symlink(E,y)}else return P},path_unlink_file(c,u,f){const g=new Uint8Array(a.inst.exports.memory.buffer);if(a.fds[c]!=null){const _=new TextDecoder("utf-8").decode(g.slice(u,u+f));return a.fds[c].path_unlink_file(_)}else return P},poll_oneoff(c,u,f){throw"async io not supported"},proc_exit(c){throw"exit with exit code "+c},proc_raise(c){throw"raised signal "+c},sched_yield(){},random_get(c,u){const f=new Uint8Array(a.inst.exports.memory.buffer);for(let g=0;g<u;g++)f[c+g]=Math.random()*256|0},sock_recv(c,u,f){throw"sockets not supported"},sock_send(c,u,f){throw"sockets not supported"},sock_shutdown(c,u){throw"sockets not supported"},sock_accept(c,u){throw"sockets not supported"}}}};class gt{fd_advise(e,t,s){return-1}fd_allocate(e,t){return-1}fd_close(){return 0}fd_datasync(){return-1}fd_fdstat_get(){return{ret:-1,fdstat:null}}fd_fdstat_set_flags(e){return-1}fd_fdstat_set_rights(e,t){return-1}fd_filestat_get(){return{ret:-1,filestat:null}}fd_filestat_set_size(e){return-1}fd_filestat_set_times(e,t,s){return-1}fd_pread(e,t,s){return{ret:-1,nread:0}}fd_prestat_get(){return{ret:-1,prestat:null}}fd_prestat_dir_name(){return{ret:-1,prestat_dir_name:null}}fd_pwrite(e,t,s){return{ret:-1,nwritten:0}}fd_read(e,t){return{ret:-1,nread:0}}fd_readdir_single(e){return{ret:-1,dirent:null}}fd_seek(e,t){return{ret:-1,offset:0n}}fd_sync(){return 0}fd_tell(){return{ret:-1,offset:0n}}fd_write(e,t){return{ret:-1,nwritten:0}}path_create_directory(e){return-1}path_filestat_get(e,t){return{ret:-1,filestat:null}}path_filestat_set_times(e,t,s,d,a){return-1}path_link(e,t,s,d){return-1}path_open(e,t,s,d,a,c){return{ret:-1,fd_obj:null}}path_readlink(e){return{ret:-1,data:null}}path_remove_directory(e){return-1}path_rename(e,t,s){return-1}path_symlink(e,t){return-1}path_unlink_file(e){return-1}}class pi extends gt{fd_fdstat_get(){return{ret:0,fdstat:new Jt(yt,0,this.fs_rights_base)}}fd_read(e,t){if((Number(this.fs_rights_base)&At)!==At)return{ret:P,nread:0};let s=0;for(const d of t)if(this.file_pos<this.file.data.byteLength){const a=this.file.data.slice(Number(this.file_pos),Number(this.file_pos+BigInt(d.buf_len)));e.set(a,d.buf),this.file_pos+=BigInt(a.length),s+=a.length}else break;return{ret:0,nread:s}}fd_seek(e,t){let s;switch(t){case zr:s=e;break;case jr:s=this.file_pos+e;break;case xt:s=BigInt(this.file.data.byteLength)+e;break;default:return{ret:bt,offset:0n}}return s<0?{ret:bt,offset:0n}:(this.file_pos=s,{ret:0,offset:this.file_pos})}fd_write(e,t){let s=0;if(this.file.readonly||!(Number(this.fs_rights_base)&It))return{ret:P,nwritten:s};for(const d of t){const a=e.slice(d.buf,d.buf+d.buf_len);if(this.file_pos+BigInt(a.byteLength)>this.file.size){const c=this.file.data;this.file.data=new Uint8Array(Number(this.file_pos+BigInt(a.byteLength))),this.file.data.set(c)}this.file.data.set(a.slice(0,Number(this.file.size-this.file_pos)),Number(this.file_pos)),this.file_pos+=BigInt(a.byteLength),s+=d.buf_len}return{ret:0,nwritten:s}}fd_filestat_get(){return{ret:0,filestat:this.file.stat()}}constructor(e,t=0n){super(),this.file_pos=0n,this.fs_rights_base=0n,this.file=e,this.fs_rights_base=t}}class mi extends gt{fd_fdstat_get(){return{ret:0,fdstat:new Jt(yt,0)}}fd_filestat_get(){return{ret:0,filestat:new Ct(yt,BigInt(this.file.handle.getSize()))}}fd_read(e,t){if((Number(this.fs_rights_base)&At)!==At)return{ret:P,nread:0};let s=0;for(const d of t)if(this.position<this.file.handle.getSize()){const a=new Uint8Array(e.buffer,d.buf,d.buf_len),c=this.file.handle.read(a,{at:Number(this.position)});this.position+=BigInt(c),s+=c}else break;return{ret:0,nread:s}}fd_seek(e,t){let s;switch(t){case zr:s=BigInt(e);break;case jr:s=this.position+BigInt(e);break;case xt:s=BigInt(this.file.handle.getSize())+BigInt(e);break;default:return{ret:bt,offset:0n}}return s<0?{ret:bt,offset:0n}:(this.position=s,{ret:Ae,offset:this.position})}fd_write(e,t){let s=0;if(this.file.readonly||!(Number(this.fs_rights_base)&It))return{ret:P,nwritten:s};for(const d of t){const a=new Uint8Array(e.buffer,d.buf,d.buf_len),c=this.file.handle.write(a,{at:Number(this.position)});this.position+=BigInt(c),s+=c}return{ret:Ae,nwritten:s}}fd_datasync(){return this.file.handle.flush(),Ae}fd_sync(){return this.fd_datasync()}fd_close(){return Ae}constructor(e,t=0n){super(),this.position=0n,this.fs_rights_base=0n,this.file=e,this.fs_rights_base=t}}class Vr extends gt{fd_fdstat_get(){return{ret:0,fdstat:new Jt(Kt,0)}}fd_readdir_single(e){if(X.enabled&&(X.log("readdir_single",e),X.log(e,Object.keys(this.dir.contents))),X.log(e,Object.keys(this.dir.contents).slice(Number(e))),e>=BigInt(Object.keys(this.dir.contents).length))return{ret:0,dirent:null};const t=Object.keys(this.dir.contents)[Number(e)],s=this.dir.contents[t];return{ret:0,dirent:new ui(e+1n,t,s.stat().filetype)}}path_filestat_get(e,t){const s=this.dir.get_entry_for_path(t);return s==null?{ret:qr,filestat:null}:{ret:0,filestat:s.stat()}}path_open(e,t,s,d,a,c){let u=this.dir.get_entry_for_path(t);if(u==null)if((s&Zt)==Zt)u=this.dir.create_entry_for_path(t,(s&Et)==Et);else return{ret:qr,fd_obj:null};else if((s&Hr)==Hr)return{ret:ai,fd_obj:null};if((s&Et)==Et&&u.stat().filetype!=Kt)return{ret:oi,fd_obj:null};if(u.readonly&&(d&BigInt(It))==BigInt(It))return{ret:Yt,fd_obj:null};if(!(u instanceof tt)&&(s&Qr)==Qr){const f=u.truncate();if(f!=Ae)return{ret:f,fd_obj:null}}return{ret:Ae,fd_obj:u.open(c,d)}}path_create_directory(e){return this.path_open(0,e,Zt|Et,0n,0n,0).ret}path_unlink_file(e){return delete this.dir.contents[e],Ae}constructor(e){super(),this.dir=e}}class yi extends Vr{fd_prestat_get(){return{ret:0,prestat:er.dir(this.prestat_name.length)}}fd_prestat_dir_name(){return{ret:0,prestat_dir_name:this.prestat_name}}constructor(e,t){super(new tt(t)),this.prestat_name=new TextEncoder().encode(e)}}class Ei{open(e,t){const s=new pi(this,t);return e&$r&&s.fd_seek(0n,xt),s}get size(){return BigInt(this.data.byteLength)}stat(){return new Ct(yt,this.size)}truncate(){return this.readonly?Yt:(this.data=new Uint8Array([]),Ae)}constructor(e,t){this.data=new Uint8Array(e),this.readonly=!!(t!=null&&t.readonly)}}class gi{open(e,t){const s=new mi(this,t);return e&$r&&s.fd_seek(0n,xt),s}get size(){return BigInt(this.handle.getSize())}stat(){return new Ct(yt,this.size)}truncate(){return this.readonly?Yt:(this.handle.truncate(0),Ae)}constructor(e,t){this.handle=e,this.readonly=!!(t!=null&&t.readonly)}}class tt{open(e){return new Vr(this)}stat(){return new Ct(Kt,0n)}get_entry_for_path(e){let t=this;for(const s of e.split("/")){if(s=="")break;if(s!="."){if(!(t instanceof tt))return null;if(t.contents[s]!=null)t=t.contents[s];else return X.log(`component ${s} undefined`),null}}return t}create_entry_for_path(e,t){let s=this;const d=e.split("/").filter(a=>a!="/");for(let a=0;a<d.length;a++){const c=d[a];if(!(s instanceof tt))break;s.contents[c]!=null||(X.log("create",c),a==d.length-1&&!t?s.contents[c]=new Ei(new ArrayBuffer(0)):s.contents[c]=new tt({})),s=s.contents[c]}return s}constructor(e){this.readonly=!1,this.contents=e}}class Xr extends gt{constructor(t){super();j(this,"fn");this.fn=t}fd_write(t,s){let d=0;for(const a of s){const c=t.slice(a.buf,a.buf+a.buf_len);this.fn(new TextDecoder().decode(c)),d+=a.buf_len}return{ret:0,nwritten:d}}}class Nt extends gt{constructor(){super()}}async function tr(r,e){const t={};for await(const[s,d]of r.entries())if(d.kind==="file"){const a=d;t[s]=new gi(await a.createSyncAccessHandle())}else if(d.kind==="directory")t[s]=await tr(d,e+"/"+s);else throw new Error("Unknown item kind: "+d.kind);return new yi(e,t)}class Ot{constructor(e){j(this,"wasi");this.wasi=e}static async create(e){const t=await navigator.storage.getDirectory(),s=[];if(e.stdin===0)s.push(new Nt);else if(e.stdin===void 0)s.push(new Nt);else throw new Error("Unsupported stdin mode");if(e.stdout===1)s.push(new Xr(console.log.bind(console,"stdout: ")));else if(e.stdin===void 0)s.push(new Nt);else throw new Error("Unsupported stdout mode");if(e.stderr===2)s.push(new Xr(console.error.bind(console,"stderr: ")));else if(e.stdin===void 0)s.push(new Nt);else throw new Error("Unsupported stderr mode");for(const[a,c]of Object.entries(e.preopens||{}))if(c.startsWith("opfs:")){const u=c.slice(5);if(u==="/")s.push(await tr(t,a));else{const f=await t.getDirectoryHandle(u,{create:!0});s.push(await tr(f,a))}}const d=Object.entries(e.env||{}).map(([a,c])=>`${a}=${c}`);return new Ot(new hi(e.args||[],d,s,{debug:!0}))}start(e){this.wasi.start(e)}initialize(e){this.wasi.initialize(e)}getImports(){return this.wasi.wasiImport}}const Ut=ot("wasmrs:worker");class _i{constructor(e,t){j(this,"instance");this.instance=e,t.addEventListener("message",d=>{this.handleMessage(d)}),e.addEventListener("frame",d=>{const a=d;t.postMessage(a.payload)});const s={success:!0,operations:e.operations};Ut("started"),t.postMessage(s)}handleMessage(e){Ut("received frame "),this.instance.send(e.data)}}function vi(r){ot.enabled("wasmrs:worker*");const e=async t=>{r.removeEventListener("message",e),Ut("received init message %o",{wasi:t.data.wasi});const d=await Ce.from(t.data.module).instantiate({wasi:t.data.wasi});new _i(d,r)};Ut("starting"),r.addEventListener("message",e)}Ht.setWasi(Ot);const Ri=()=>{vi(self)};Ht.setWasi(Ot),Ri()})();
